"use strict";var app=angular.module("codeboardApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ui.ace","angularTreeview","ui.bootstrap","angularFileUpload","ui.select","ngGrid","kendo.directives","chart.js","ngWebSocket","luegg.directives","datatables","ui.bootstrap.datetimepicker"]);app.config(["ChartJsProvider",function(a){a.setOptions({colours:["#949FB1","#97BBCD"],responsive:!0,maintainAspectRatio:!1,pointHitDetectionRadius:1})}]),app.config(["$logProvider",function(a){a.debugEnabled(!1)}]),app.config(["uiSelectConfig",function(a){a.theme="selectize"}]),app.config(["$httpProvider",function(a){a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",a.defaults.headers.get["Cache-Control"]="no-cache",a.defaults.headers.get.Pragma="no-cache"}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"partials/main",controller:"MainCtrl"}).when("/about",{templateUrl:"partials/about"}).when("/contact",{templateUrl:"partials/contact"}).when("/signin",{templateUrl:"partials/signin",controller:"SigninCtrl"}).when("/signup",{templateUrl:"partials/signup",controller:"SignupCtrl"}).when("/passwordreset",{templateUrl:"partials/passwordReset",controller:"PasswordResetCtrl"}).when("/users",{templateUrl:"partials/usersAll",controller:"usersAllCtrl"}).when("/users/:username/settings/",{templateUrl:"partials/userSettings",controller:"UserSettingsCtrl",resolve:{userData:["$route","UserResSettings",function(a,b){return b.get({username:a.current.params.username}).$promise}]}}).when("/users/:username",{templateUrl:"partials/userProjects",controller:"UserProjectsCtrl",resolve:{userData:["$route","UserRes",function(a,b){return b.get({username:a.current.params.username}).$promise}]}}).when("/projects/new",{templateUrl:"partials/projectNew",controller:"ProjectNewCtrl",resolve:{isAuth:["$q","UserSrv",function(a,b){var c=a.defer();return b.isAuthenticated()?c.resolve():c.reject({status:401}),c.promise}]}}).when("/projects/:projectId/settings",{templateUrl:"partials/projectSettings",controller:"ProjectSettingsCtrl",resolve:{projectData:["$route","ProjectSettingsRes",function(a,b){return b.get({projectId:a.current.params.projectId}).$promise}]}}).when("/projects/:projectId/summary",{templateUrl:"partials/projectSummary",controller:"ProjectSummaryCtrl",resolve:{projectSummaryData:["$route","ProjectSummaryRes",function(a,b){return b.get({projectId:a.current.params.projectId}).$promise}]}}).when("/projects/:projectId/stats",{templateUrl:"partials/projectStats",controller:"ProjectStatsCtrl",resolve:{placeHolder:["$route","$http",function(a,b){return b.get("/api/projects/"+a.current.params.projectId+"/authorizedownercheck")}]}}).when("/projects/:projectId/submissions",{templateUrl:"partials/projectSubmissions",controller:"ProjectSubmissionsCtrl",resolve:{AuthorizedUser:["$route","$http",function(a,b){return b.get("/api/projects/"+a.current.params.projectId+"/authorizedownercheck")}]}}).when("/projects/:projectId/userprojects",{templateUrl:"partials/projectUserProjects",controller:"ProjectUserProjectsCtrl",resolve:{placeHolder:["$route","$http",function(a,b){return b.get("/api/projects/"+a.current.params.projectId+"/authorizedownercheck")}]}}).when("/projects/:projectId",{templateUrl:"partials/ide",controller:"IdeCtrl",resolve:{ltiData:["$route","$q",function(a,b){var c=b.defer(),d={};return a.current.params.ltiSessionId&&(d.ltiSessionId=decodeURIComponent(a.current.params.ltiSessionId)),a.current.params.ltiUserId&&(d.ltiUserId=decodeURIComponent(a.current.params.ltiUserId)),a.current.params.ltiNonce&&(d.ltiNonce=decodeURIComponent(a.current.params.ltiNonce)),c.resolve(d),c.promise}],projectData:["$route","ProjectRes",function(a,b){var c=function(){var b=[];return a.current.params.ltiSessionId&&b.push(a.current.params.ltiSessionId),a.current.params.ltiUserId&&b.push(a.current.params.ltiUserId),a.current.params.ltiNonce&&b.push(a.current.params.ltiNonce),b},d=c();return 3===d.length?b.get({projectId:a.current.params.projectId,ltiSessionId:d[0],ltiUserId:d[1],ltiNonce:d[2]}).$promise:b.get({projectId:a.current.params.projectId}).$promise}]}}).when("/projects/:projectId/submissions/:submissionId",{templateUrl:"partials/ide",controller:"IdeCtrl",resolve:{ltiData:["$route","$q",function(a,b){var c=b.defer(),d={};return c.resolve(d),c.promise}],projectData:["$route","$http",function(a,b){return b.get("/api/projects/"+a.current.params.projectId+"/submissions/"+a.current.params.submissionId).then(function(b){var c={projectname:b.data.project.projectname,language:b.data.project.language,context:{name:"submission",submissionId:a.current.params.submissionId},userRole:"submission",username:b.data.user.username};c.fileSet=b.data.userFilesDump.concat(b.data.hiddenFilesDump);var d=0;return c.fileSet.every(function(a){a.uniqueId>d&&(d=a.uniqueId)}),c.lastUId=d,c.isSubmissionAllowed=!1,c})}]}}).when("/projects/:projectId/userprojects/:userprojectId",{templateUrl:"partials/ide",controller:"IdeCtrl",resolve:{ltiData:["$route","$q",function(a,b){var c=b.defer(),d={};return c.resolve(d),c.promise}],projectData:["$route","UserProjectRes",function(a,b){return b.get({projectId:a.current.params.projectId,userprojectId:a.current.params.userprojectId}).$promise}]}}).when("/verifications/email",{templateUrl:"partials/verificationEmail",controller:"VerificationCtrl",resolve:{verificationResult:["$route","$http",function(a,b){var c=a.current.params.token;return b.get("/api/verifications/email?token="+c).then(function(a){return a.data})["catch"](function(a){return console.error("Error calling /api/verifications/email:"+JSON.stringify(a)),{msg:"Error while trying to verify email token. Please try again."}})}]}}).when("/projects",{templateUrl:"partials/projectsAll",controller:"projectsAllCtrl"}).when("/logs",{templateUrl:"partials/logs",controller:"LogsCtrl"}).when("/support/lti/debug",{templateUrl:"partials/supportLtiDebug",controller:"SupportCtrl"}).when("/docs",{redirectTo:"/docs/project"}).when("/docs/:docId",{templateUrl:"partials/docs",controller:"DocumentationCtrl"}).when("/legal",{redirectTo:"/legal/terms"}).when("/legal/:docId",{templateUrl:"partials/legal",controller:"LegalCtrl"}).when("/404",{templateUrl:"partials/404",controller:"ErrorCtrl"}).when("/401",{templateUrl:"partials/401",controller:"ErrorCtrl"}).otherwise({redirectTo:"/404"}),b.html5Mode(!0)}]),app.run(["$rootScope","$route","$location","UserSrv",function(a,b,c,d){a.$on("$routeChangeStart",function(){window.onbeforeunload=null,d.isAuthenticated()||d.tryAuthenticateUser()}),a.$on("$routeChangeError",function(a,b,d,e){401===e.status?c.path("/401").replace():c.path("/404").replace()})}]),angular.module("codeboardApp").component("projectCard",{templateUrl:"/components/coboProjectCard/projectCard.html",bindings:{project:"<",user:"<",showBtnGroup:"<?",boldBorderInColor:"@?"},controller:function(){var a=this;a.customBorderStyle={},this.$onInit=function(){this.showBtnGroup!==!1&&(this.showBtnGroup=!0),this.boldBorderInColor&&(a.customBorderStyle={"border-right-width":"3px","border-right-color":this.boldBorderInColor})}}}),angular.module("codeboardApp").controller("MainCtrl",["$scope","$rootScope","$http","$location","UserSrv",function(a,b,c,d,e){a.authFailed=!1,a.init=function(){e.isAuthenticated()&&d.path("/users/"+e.getUsername())}(),a.login=function(b){a.authFailed=!1;var e={username:b.username,password:b.password};c.post("/api/session",e).then(function(a){d.path("/users/"+a.data.username)},function(){console.error("Sign in failed!"),a.authFailed=!0})}}]),angular.module("codeboardApp").controller("NavbarCtrl",["$scope","$location","UserSrv",function(a,b,c){a.username=c.getUsername(),a.isAuth=c.isAuthenticated(),a.$on("userLoggedIn",function(){a.username=c.getUsername(),a.isAuth=c.isAuthenticated()}),a.signOut=function(){c.signOutUser()}}]),angular.module("codeboardApp").controller("SignupCtrl",["$scope","$rootScope","$http","$location",function(a,b,c,d){a.data={},a.serverError={userExists:!1,emailExists:!1,invalidUsername:!1,hasErrors:!1,errorMsg:""},a.submitted=!1,a.currentlySubmitting=!1,a.register=function(b){if(a.submitted=!0,b.$valid&a.data.password===a.data.passwordConfirm&&0==a.currentlySubmitting){a.currentlySubmitting=!0;var e={username:a.data.username,password:a.data.password,email:a.data.email};c.post("/api/users",e).then(function(){a.serverError.userExists=!1,a.serverError.emailExists=!1,a.serverError.invalidUsername=!1,a.currentlySubmitting=!1,c.post("/api/session",{username:a.data.username,password:a.data.password}).then(function(a){d.path("/users/"+a.data.username)})},function(b){422===b.status?(a.serverError.hasErrors=!0,a.serverError.errorMsg=b.data.msg):409===b.status?("UserExists"===b.data.error&&(a.serverError.userExists=!0),"EmailExists"===b.data.error&&(a.serverError.emailExists=!0),"InvalidUsername"===b.data.error&&(a.serverError.invalidUsername=!0)):(a.serverError.hasErrors=!0,a.serverError.errorMsg=b.data.msg),a.currentlySubmitting=!1})}}}]),angular.module("codeboardApp").controller("SigninCtrl",["$scope","$rootScope","$http","$location","$routeParams",function(a,b,c,d,e){a.formData={},a.signinFailed=!1,a.signin=function(b){a.submitted=!0;var f={username:b.username,password:b.password};c.post("/api/session",f).then(function(a){e.redirect?d.url(e.redirect):d.path("/users/"+a.data.username)},function(b){a.signinFailed=!0,a.formData.error=401===b.status?"Invalid username, email or password.":"Unknown error. Please try again."})}}]),angular.module("codeboardApp").controller("PasswordResetCtrl",["$scope","$rootScope","$http","$location","$routeParams",function(a,b,c){a.formData={},a.submitted=!1,a.isUnderSubmission=!1,a.server={resetSuccess:!1,errorUnknownFailure:!1,errorEmailUnknown:!1},a.resetPassword=function(b){a.submitted=!0,a.isUnderSubmission=!0,a.server.resetSuccess=!1,a.server.errorEmailUnknown=!1,a.server.errorUnknownFailure=!1;var d={email:b.email};c.put("/api/passwordreset",d).then(function(){a.server.resetSuccess=!0,a.isUnderSubmission=!1},function(b){a.isUnderSubmission=!1,403===b.status?a.server.errorEmailUnknown=!0:a.server.errorUnknownFailure=!0})}}]);var app=angular.module("codeboardApp");app.controller("IdeCtrl",["$scope","$rootScope","$log","$sce","$location","$routeParams","$window","$http","$timeout","$uibModal","ProjectFactory","projectData","ltiData","IdeMsgService","IdeSnippetsSrv","UserSrv","WebsocketSrv",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){k.setProjectFromJSONdata(l,m);var r=function(){if("user"==k.getProject().userRole&&p.isAuthenticated()){var a="/api/users/"+p.getUsername()+"/projects/"+f.projectId;f.ltiSessionId&&f.ltiUserId&&f.ltiNonce&&(a+="?ltiSessionId="+f.ltiSessionId+"&ltiUserId="+f.ltiUserId+"&ltiNonce="+f.ltiNonce),h.get(a).then(function(a){var d=["$scope","$uibModalInstance","UserSrv",function(a,b,c){a.ok=function(){b.close()},a.cancel=function(){b.dismiss()},a.getUsername=function(){return c.getUsername()}}],e=function(a,e){var f=j.open({templateUrl:"ideLoadUserProjectModal.html",controller:d});f.result.then(function(){c.debug("User confirmed to load saved project."),a&&a(),b.$broadcast(n.msgProcessViewQueryStringRequest().msg)},function(){c.debug("User canceled loading of the saved project."),e&&e(),b.$broadcast(n.msgProcessViewQueryStringRequest().msg)})};e(function(){var c={name:k.getProject().name,lastUId:a.data.project.lastUId,language:k.getProject().language,userRole:k.getProject().userRole,fileSet:a.data.files};k.setProjectFromJSONdata(c,m,k.getProject().staticFiles),b.$broadcast(n.msgReloadTreeFromProjectFactory().msg)})},function(a){c.debug(a),b.$broadcast(n.msgProcessViewQueryStringRequest().msg)})}else b.$broadcast(n.msgProcessViewQueryStringRequest().msg)};g.onbeforeunload=function(a){var b="You currently have unsaved changes.";return t(),"undefined"==typeof a&&(a=window.event),a&&k.isProjectModified()?(a.returnValue=b,b):null},a.$on("$locationChangeStart",function(a){if(t(),k.isProjectModified()){var b="You currently have unsaved changes.\n\nAre you sure you want to leave this page?",c=confirm(b);c||a.preventDefault()}});var s=function(){if(f.view){c.debug('idejs.processViewQueryString: Found a "view" query string in the URL: '+f.view);for(var a=[],d=f.view.split("-"),e=0;e<d.length;e++){var g=d[e].split(".");if(2!=g.length||!isNaN(g[0])||!isNaN(g[1])){var h=parseInt(g[0]),i=parseInt(g[1]);if(k.hasNode(h)&&!k.getNode(h).isFolder){var j={nodeId:h,nodeActive:i};a.push(j)}}}for(var e=0;e<a.length;e++){var l=n.msgDisplayFileRequest(a[e].nodeId);b.$broadcast(l.msg,l.data)}for(var e=0;e<a.length;e++)if(a[e].nodeActive){var l=n.msgDisplayFileRequest(a[e].nodeId);b.$broadcast(l.msg,l.data)}}},t=function(){-1!==a.ace.currentNodeId&&(k.getNode(a.ace.currentNodeId).content=a.ace.editor.getSession().getValue())},u=function(d,e,f){var g=0,i=32e3,j=f||!a.isCompilationNeeded();y("",j);var k=function(){h.get(e).then(function(){c.debug("idejs.displayOutputStream.onWSOpenCallback: container successfully started"),G.actionAllowsForStopping&&b.$broadcast(n.msgStoppableActionAvailable().msg)},function(a){c.debug("idejs.displayOutputStream.onWSOpenCallback: problem starting container."),c.debug(a)})},l=function(a){var b=z(a,j);g+=1,b>i&&(z("\n\nYour program output has more than "+i+" characters. That's quite a lot.\nFor this reason, Codeboard has terminated your program.\n\n",j),q.close(!0))},m=function(){0===g&&z("--Session ended without output.--",!1),b.$broadcast(n.msgStoppableActionGone().msg),I(1,1,1,1,1)};q.connect(d,k,l,m)},v=function(a){a.bodyElement.scrollTop=a.bodyElement.scrollHeight,a.iframeDocument.documentElement.scrollTop=a.bodyElement.scrollHeight},w=function(a,b){var c=document.getElementById(a);if(c)var d=c.contentDocument||c.contentWindow.document,e=d.getElementById(b);return{iframeElement:c,iframeDocument:d,bodyElement:e}},x=function(a){var b=w("ideOutputIframe","codeboardioIdeOutputBody");if(b.iframeElement){var c=!1;if(b.bodyElement){var d=b.bodyElement.scrollTop||b.iframeDocument.documentElement.scrollTop;c=d+b.iframeElement.clientHeight+1>=b.bodyElement.scrollHeight}b.bodyElement&&void 0!==a&&null!==a&&(b.bodyElement.innerHTML=a,c&&v(b))}};a.$on(n.msgEditorResizeRequest().msg,function(){var a=w("ideOutputIframe","coboIdeOutputTemplateBody");a.bodyElement&&v(a)});var y=function(b,c){var d=c?c:!1;a.renderHtmlOutput=d,a.output=b,d&&x(b)},z=function(b,c){var d=c?c:!1;return a.renderHtmlOutput=d,a.output+=b,d&&x(a.output),a.output.length};y("This will display the output.",!1),"WebSocket"in window&&("function"==typeof WebSocket||"object"==typeof WebSocket)?c.debug("Info: Browser supports WebSockets"):y("Warning: your browser does not support WebSockets.\nThis may cause Codeboard to not work properly.\nPlease consider updating to a newer browser.",!1);var A=function(a){t(),y("Waiting for results...",!1),I(0,0,0,0,0);var d=k.compileProject(a);d.then(function(a){G.stopUrl=a.stopUrl,u(a.streamUrl,a.startUrl)},function(a){c.debug("Error while trying to run your program. The server responded:\n"+a),y("Error while trying to run your program. The server responded:\n"+a,!1),I(1,0,0,1,0),b.$broadcast(n.msgStoppableActionGone().msg)})},B=function(){y("Waiting for results...",!1),I(0,0,0,0,0),k.runProject().then(function(a){G.stopUrl=a.stopUrl,u(a.streamUrl,a.startUrl,!0)},function(a){c.debug("Error when trying to run your program. The server responded:\n"+a),y("Error when trying to run your program. The server responded:\n"+a,!1),I(1,0,0,1,0),b.$broadcast(n.msgStoppableActionGone().msg)}),a.ace.editor.focus()},C=function(){t(),y("Testing your solution. This might take a few seconds. Please wait...",!1),I(0,0,0,0,0);var a=k.testProject();a.then(function(a){c.debug("Testing successful."),a.compilationError?y("Testing failed. Your program does not compile.\nFix all compilation errors and try again.\n\n--- Details ---\n\n"+a.outputCompiler,!1):y("Number of passing tests: "+a.numTestsPassing+"\nNumber of failing tests: "+a.numTestsFailing+"\n\n--- Details ---\n\n"+a.output,!1),I(1,0,1,1,1)},function(a){c.debug("Error while trying to test your program. The server responded:\n"+a),y("Error while trying to test your program. The server responded:\n"+a,!1),I(1,0,1,1,0)})},D=function(){t(),y("Analyzing your project. This might take a few seconds. Please wait...",!1),I(0,0,0,0,0);var a=k.toolAction();a.then(function(a){c.debug("Tool action successful."),a.compilationError?y("Analysis failed. Your program does not compile.\nFix all compilation errors and try again.\n\n--- Details ---\n\n"+a.outputCompiler,!1):y(a.output,!1),I(1,0,1,1,1)},function(a){c.debug("Error while running the tool-action on your program. The server responded:\n"+a),y("Error while running the requested action on your program. The server responded:\n"+a,!1),I(1,0,1,1,0)})},E=function(){t(),y("Submitting your solution. This might take a few seconds. Please wait...",!1),I(0,0,0,0,0);var a=k.submitProject();a.then(function(a){c.debug("Submission successful."),a.msg&&a.submissionFeedback?y(a.msg+"\n"+a.submissionFeedback,!0):y(a.msg,!1),I(1,0,1,1,1)},function(a){if(c.debug("ide.js: Submission failed: "+a.data.msg),a.data.errorType)switch(a.data.errorType){case"submissionTimeRestrictionStart":y("WARNING!\nSubmissions for this project are not yet accepted.\nAcceptance starts on: "+new Date(a.data.timestampRestrictionStart),!1);break;case"submissionTimeRestrictionEnd":y("WARNING!\nSubmissions for this project are no longer accepted.\nAcceptance ended on: "+new Date(a.data.timestampRestrictionEnd),!1);break;default:y(a.data.msg,!1)}else a.data.msg?y(a.data.msg,!1):y("Error!\n An unknown error occured while submitting this project.\nTry again or contact support@codeboard.io\n\nError log:\n"+JSON.stringify(a.data),!1);I(1,0,1,1,1)})},F=function(){G.stopUrl&&h.get(G.stopUrl).then(function(){z("\n\n--Program stopped--",!0)},function(){c.debug("An error occurred while trying to stop your program."),z("\n\nAn error occurred while trying to stop your program.",!0)})},G={actionAllowsForStopping:!1,stopUrl:""};a.projectName=k.getProject().name,a.ace={currentNodeId:-1,editor:null,isVisible:!1},a.aceLoaded=function(b){a.ace.editor=b},a.uiSettings={showSubmissionBtn:l.isSubmissionAllowed,showOutputAsText:!1},a.disabledActions={compile:!1,run:!0,stop:!0,test:!0,tool:!1,submit:!0},a.hiddenActions={compileDynamic:!1,run:!1,stop:!0},a.aceEditorSettings={theme:"eclipse",fontSize:"12px",handler:"ace",tabSize:4,invisibles:"Hide",gutter:"Show"};var H;a.signinSettings={userIsAuthenticated:function(){return p.isAuthenticated()},signinPathWithRedirect:function(){return"/signin?redirect="+encodeURIComponent(e.url())}};var I=function(b,c,d,e,f){a.disabledActions.compile=!(1==b),a.disabledActions.run=!(1==c),a.disabledActions.test=!(1==d),a.disabledActions.tool=!(1==e),a.disabledActions.submit=!(1==f),a.$$phase||a.$digest()};a.currentRoleIsOwner=function(){return"owner"===k.getProject().userRole},a.currentRoleIsAssistant=function(){return"assistant"===k.getProject().userRole},a.currentRoleIsUser=function(){return"user"===k.getProject().userRole},a.currentRoleIsSubmission=function(){return"submission"===k.getProject().userRole},a.currentRoleIsUserProject=function(){return"userproject"===k.getProject().userRole},a.navBarClick=function(d){switch(c.debug("NavBarClick with id: "+d),d){case"add_file":var e=n.msgNewNodeRequest("file");b.$broadcast(e.msg,e.data);break;case"add_folder":var e=n.msgNewNodeRequest("folder");b.$broadcast(e.msg,e.data);break;case"rename_node":var e=n.msgRenameNodeRequest();b.$broadcast(e.msg);break;case"remove_node":var e=n.msgRemoveNodeRequest();b.$broadcast(e.msg);break;case"save_project":var e=n.msgSaveProjectRequest();b.$broadcast(e.msg);break;case"hide_file":var e=n.msgHideNodeRequest();b.$broadcast(e.msg);break;case"show_share_project":var e=n.msgShowShareProjectModalRequest();b.$broadcast(e.msg);break;case"show_editor_settings":var e=n.msgShowEditorSettingsRequest(a.aceEditorSettings);b.$broadcast(e.msg,e.data);break;case"show_output_as_text":var e=n.msgShowOutputAsText();b.$broadcast(e.msg);break;case"compile":if(!a.disabledActions.compile){var e=n.msgCompileRequest();b.$broadcast(e.msg)}break;case"compileDynamic":if(!a.disabledActions.compile){var e=n.msgCompileRequest();b.$broadcast(e.msg),G.actionAllowsForStopping=!0}break;case"compile_clean":if(!a.disabledActions.compile){var e=n.msgCompileCleanRequest();b.$broadcast(e.msg)}break;case"run":if(!a.disabledActions.run){var e=n.msgRunRequest();b.$broadcast(e.msg),G.actionAllowsForStopping=!0}break;case"stop":var e=n.msgStopRequest();b.$broadcast(e.msg);break;case"test":if(!a.disabledActions.test){var e=n.msgTestRequest();b.$broadcast(e.msg)}break;case"tool":if(!a.disabledActions.tool){var e=n.msgToolRequest();b.$broadcast(e.msg)}break;case"submit":if(!a.disabledActions.submit){var e=n.msgSubmitRequest();b.$broadcast(e.msg)}}},a.$on(n.msgDisplayFileRequest().msg,function(b,d){if(-1!==a.ace.currentNodeId&&(k.getNode(a.ace.currentNodeId).session=a.ace.editor.getSession(),k.getNode(a.ace.currentNodeId).content=a.ace.editor.getSession().getValue()),void 0!==k.getNode(d.nodeId).session&&null!==k.getNode(d.nodeId).session)a.ace.editor.setSession(k.getNode(d.nodeId).session);else{var e=k.getNode(d.nodeId),f=e.content,g="ace/mode/text",i=e.filename.split(".").pop();switch(i){case"e":g="ace/mode/eiffel";break;case"ecf":g="ace/mode/xml";break;case"java":g="ace/mode/java";break;case"html":g="ace/mode/html";break;case"htm":g="ace/mode/html";break;case"py":g="ace/mode/python";break;case"c":g="ace/mode/c_cpp";break;case"h":g="ace/mode/c_cpp";break;case"cpp":g="ace/mode/c_cpp";break;case"hs":g="ace/mode/haskell";break;case"json":g="ace/mode/json";break;case"re":g="ace/mode/swift";break;case"rei":g="ace/mode/swift";break;default:g="ace/mode/text"}a.ace.editor.setSession(ace.createEditSession(f,g)),H=a.ace.editor.getKeyboardHandler(),a.ace.editor.getSession().setTabSize("ace/mode/haskell"===g?8:4);{var j=ace.require("ace/snippets").snippetManager;ace.require("ace/config")}ace.config.loadModule("ace/ext/language_tools",function(){a.ace.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),"ace/mode/eiffel"==g&&ace.config.loadModule("ace/snippets/eiffel",function(a){if(a){j.files.eiffel=a,a.snippetText="snippet feature modifier\n	feature {${1:CLASS}} -- ${2:comment}  \n",a.snippets=j.parseSnippetFile(a.snippetText);for(var b=0;b<o.getEiffelSnippet().length;b++)a.snippets.push(o.getEiffelSnippet()[b]);j.register(a.snippets,a.scope)}}),e.url&&!e.isContentSet&&h.get(e.url).then(function(b){c.debug("Got HTTP response for content of the file"),k.getNode(d.nodeId).content=b.data,k.getNode(d.nodeId).isContentSet=!0,a.ace.editor.getSession().setValue(b.data)},function(a){c.debug(a)})}a.ace.editor.setReadOnly("string"==typeof d.nodeId&&"s"===d.nodeId.charAt(0)?!0:!1),a.ace.currentNodeId=d.nodeId,a.ace.editor.focus()}),a.splitterResizeEvent=function(){var a=n.msgEditorResizeRequest();b.$broadcast(a.msg)},a.$on(n.msgEditorResizeRequest().msg,function(){a.ace.editor.resize()}),a.$on(n.msgSaveProjectRequest().msg,function(){c.debug("Save request received"),t(),k.saveProjectToServer().then(function(){y('<span style="color: green;">Changes successfully saved.</span>',!0),i(function(){y("This will display the output.",!1)},2500)},function(a){401===a.status?y('<span style="color: red">WARNING: Unable to save your changes.<br><br>What now: maybe you\'re currently not logged in.<br>Open a new browser tab for codeboard.io, login, and then come back to this tab and try to save your changes.<br>If the problem persists, contact us at: support@codeboard.io</span>',!0):403===a.status?y("<span style=\"color: red\">WARNING: Unable to save your changes.<br><br>What now: you're logged in but you don't have permission to save changes to this project.<br>To save changes you need to be an 'Owner' or 'User' of this project.<br></span>",!0):y('<span style="color: red">WARNING: Unable to save your changes.<br><br>If the problem persists, contact us at: support@codeboard.io</span>',!0)}),a.ace.editor.focus()}),a.$on(n.msgShowEditorSettingsRequest().msg,function(a,b){var d=["$rootScope","$scope","$uibModalInstance",function(a,c,d){var e=angular.copy(b.settings);c.editorSettings=angular.copy(b.settings),c.ok=function(){var b=n.msgEditorSettingsChanged(c.editorSettings);a.$broadcast(b.msg,b.data),d.close()},c.preview=function(){var b=n.msgEditorSettingsChanged(c.editorSettings);a.$broadcast(b.msg,b.data)},c.cancel=function(){var b=n.msgEditorSettingsChanged(e);a.$broadcast(b.msg,b.data),d.dismiss()}}],e=function(a,b){var e=j.open({templateUrl:"ideEditorSettingsModal.html",controller:d});e.result.then(function(){c.debug("User confirmed changes to editor settings."),a&&a()},function(){c.debug("User canceled changes to editor settings."),b&&b()})};e(function(){},function(){})}),a.$on(n.msgEditorSettingsChanged().msg,function(b,c){a.aceEditorSettings=c.settings,a.ace.editor.setKeyboardHandler("ace"!=a.aceEditorSettings.handler?"ace/keyboard/"+a.aceEditorSettings.handler:H),a.ace.editor.setTheme("ace/theme/"+a.aceEditorSettings.theme),a.ace.editor.setFontSize(a.aceEditorSettings.fontSize),a.ace.editor.getSession().setTabSize(a.aceEditorSettings.tabSize),a.ace.editor.setShowInvisibles("Show"===a.aceEditorSettings.invisibles?!0:!1),a.ace.editor.renderer.setShowGutter("Show"===a.aceEditorSettings.gutter?!0:!1)}),a.$on(n.msgShowOutputAsText().msg,function(){a.uiSettings.showOutputAsText=!a.uiSettings.showOutputAsText}),a.$on(n.msgCompileRequest().msg,function(){c.debug("Compile request received"),A(!1),a.ace.editor.focus()}),a.$on(n.msgCompileCleanRequest().msg,function(){c.debug("Clean-compile request received"),A(!0),a.ace.editor.focus()}),a.$on(n.msgRunRequest().msg,function(){c.debug("Run request received"),B()}),a.$on(n.msgStopRequest().msg,function(){c.debug("Stop request received"),F()}),a.$on(n.msgTestRequest().msg,function(){c.debug("Test request received"),C(),a.ace.editor.focus()}),a.$on(n.msgToolRequest().msg,function(){c.debug("Tool request received"),D(),a.ace.editor.focus()}),a.$on(n.msgSubmitRequest().msg,function(){if(c.debug("Submit request received"),p.isAuthenticated()||k.getProject().hasLtiData)E();else{var b=["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss()}}],d=function(a,d){var e=j.open({templateUrl:"ideConfirmAnonymousSubmissionModal.html",controller:b});e.result.then(function(){c.debug("User confirmed submit anonymously."),a&&a()},function(){c.debug("User canceled anonymous submission."),d&&d()})};d(E)}a.ace.editor.focus()}),a.$on(n.msgDisplayEditorRequest().msg,function(b,c){a.ace.isVisible=c.displayEditor?!0:!1}),a.$on(n.msgRemoveNodeConfirmation().msg,function(b,c){a.ace.currentNodeId===c.uniqueId&&(a.ace.currentNodeId=-1)}),a.$on(n.msgStoppableActionAvailable().msg,function(){c.debug("Event received: Stoppable action available"),a.hiddenActions.compileDynamic=!0,a.hiddenActions.run=!0,a.hiddenActions.stop=!1}),a.$on(n.msgStoppableActionGone().msg,function(){c.debug("Event received: Stoppable action gone"),a.hiddenActions.compileDynamic=!1,a.hiddenActions.run=!1,a.hiddenActions.stop=!0,G.actionAllowsForStopping=!1}),a.$on(n.msgProcessViewQueryStringRequest().msg,function(){i(function(){s()})}),a.isCompilationNeeded=function(){var a=["Python","Python-UnitTest","Python3","Python3-UnitTest"],b=!0;return-1!==a.indexOf(k.getProject().language)&&(b=!1),b},a.isTestSupported=function(){var a=["Haskell-HSpec","Java-JUnit","Python-UnitTest","Python3-UnitTest"],b=!1;return-1!==a.indexOf(k.getProject().language)&&(b=!0),b},a.isToolSupported=function(){var a=["Infer-Java"],b=!1;return-1!==a.indexOf(k.getProject().language)&&(b=!0),b},a.isEiffelLanguageCompatible=function(){return"Eiffel"===k.getProject().language},a.isSupportingCleanCompile=function(){var a=["Eiffel","Reason"],b=!1;return-1!==a.indexOf(k.getProject().language)&&(b=!0),b},a.sendUserInputClick=function(a,b){q.sendData(a?a+"\n":"\n");var c=angular.element(document.querySelector("#"+b));c&&c.focus()},r()}]),app.controller("TreeCtrl",["$scope","$rootScope","$log","ProjectFactory","IdeMsgService",function(a,b,c,d,e){a.projectNodes=d.getProject().files,a.addFile=function(){var a=e.msgNewNodeRequest("file");b.$broadcast(a.msg,a.data)},a.addFolder=function(){var a=e.msgNewNodeRequest("folder");b.$broadcast(a.msg,a.data)},a.nodeClick=function(){var c=d.getNode(a.mytree.currentNode.uniqueId);if(null!=c&&!c.isFolder){var f=e.msgDisplayFileRequest(c.uniqueId);b.$broadcast(f.msg,f.data)}},a.$on(e.msgRenameNodeRequest().msg,function(){if(0===a.mytree.currentNode.uniqueId)alert("The root folder can't be renamed.");else{var c=a.mytree.currentNode.uniqueId,f=d.getNode(c).filename,g=d.getNode(c).isFolder?"folder":"file",h=e.msgDisplayRenameNodeModalRequest(c,f,g);b.$broadcast(h.msg,h.data)}}),a.$on(e.msgRenameNodeNameAvailable().msg,function(a,c){d.renameNode(c.nodeId,c.nodeName),b.$broadcast(e.msgReloadTreeFromProjectFactory().msg)}),a.$on(e.msgRemoveNodeRequest().msg,function(){if(0===a.mytree.currentNode.uniqueId)alert("The root folder can't be deleted.");else{var c=d.getNode(a.mytree.currentNode.uniqueId).filename,f=d.getNode(a.mytree.currentNode.uniqueId).isFolder?"folder":"file",g="Do you really want to delete "+f+" '"+c+"'?",g=d.getNode(a.mytree.currentNode.uniqueId).isFolder?g+"\n\nNote: when deleting a folder, make sure it's empty.":g,h=confirm(g);if(h){var i=a.mytree.currentNode.uniqueId;d.removeNode(i,!1),d.getNode(0).selected="selected",a.mytree.currentNode=d.getNode(0);var j=e.msgRemoveNodeConfirmation(i);b.$broadcast(j.msg,j.data)}}}),a.$on(e.msgNewNodeNameAvailable().msg,function(b,c){var e=a.mytree.currentNode.uniqueId;switch(c.nodeType){case"file":d.addFile(e,c.nodeName);break;case"folder":d.addFolder(e,c.nodeName)}}),a.$on(e.msgReloadTreeFromProjectFactory().msg,function(){a.projectNodes=d.getProject().files}),a.$on(e.msgHideNodeRequest().msg,function(){c.debug("Hide_node request received");var b=a.mytree.currentNode.uniqueId;b>0?(c.debug("Node is hidden: "+d.getNode(b).isHidden),d.setNodeHidden(d.getNode(b),!d.getNode(b).isHidden),c.debug("Node is hidden: "+d.getNode(b).isHidden)):alert("The root folder can't be hidden.")})}]),app.controller("TabCtrl",["$scope","$rootScope","$log","$uibModal","ProjectFactory","IdeMsgService",function(a,b,c,d,e,f){a.tabs=[];var g=function(b){for(var c=0;c<a.tabs.length;c++)a.tabs[c].isActive=c===b},h=function(b){for(var c=0;c<a.tabs.length;c++)if(a.tabs[c].nodeIndex===b)return c;return-1};a.selectClick=function(c){var d=f.msgDisplayFileRequest(a.tabs[c].nodeIndex);b.$broadcast(d.msg,d.data)},a.closeClick=function(d){c.debug("Close-tab clicked; array-index:"+d);for(var e=d+1;e<a.tabs.length;e++)a.tabs[e].arrayIndex=a.tabs[e].arrayIndex-1;if(a.tabs[d].isActive)if(1===a.tabs.length){var g=f.msgDisplayEditorRequest(!1);b.$broadcast(g.msg,g.data)}else if(0===d){var g=f.msgDisplayFileRequest(a.tabs[d+1].nodeIndex);b.$broadcast(g.msg,g.data)}else{var g=f.msgDisplayFileRequest(a.tabs[d-1].nodeIndex);b.$broadcast(g.msg,g.data)}a.tabs.splice(d,1)},a.$on(f.msgDisplayFileRequest().msg,function(c,d){if(0===a.tabs.length){var i=f.msgDisplayEditorRequest(!0);b.$broadcast(i.msg,i.data)}var j=h(d.nodeId);if(-1===j){var k=e.getNode(d.nodeId);a.tabs.push({name:k.filename,title:k.path+"/"+k.filename,nodeIndex:d.nodeId,arrayIndex:a.tabs.length,isActive:!1}),g(a.tabs.length-1)}else g(j)}),a.$on(f.msgRenameNodeNameAvailable().msg,function(b,c){var d=h(c.nodeId);-1!==d&&(a.tabs[d].name=c.nodeName)}),a.$on(f.msgRemoveNodeConfirmation().msg,function(b,c){var d=h(c.uniqueId);-1!==d&&a.closeClick(d)}),a.$on(f.msgShowShareProjectModalRequest().msg,function(){var b=a.tabs,c=["$rootScope","$scope","$location","$uibModalInstance",function(a,c,d,e){var f=function(){var a=d.absUrl(),b=a.indexOf("?");return b>=0&&(a=a.substr(0,b)),a};c.form={inputText:f(),inputCheckbox:!1},c.checkboxChanged=function(){if(c.form.inputText=f(),c.form.inputCheckbox){var a="";
if(b.length>0){a+="?view=";for(var d=0;d<b.length;d++)a+=b[d].nodeIndex+"."+(b[d].isActive?"1":"0"),a+=d<b.length-1?"-":""}c.form.inputText+=a}},c.closeModal=function(){e.close()}}];d.open({templateUrl:"ideShareProjectModal.html",controller:c})})}]),app.controller("LibraryCtrl",["$scope","$rootScope","$http","ProjectFactory","IdeMsgService",function(a,b,c,d,e){a.file={},a.files=[];!function(){c.get("staticfiles/eiffelfiles.json").then(function(b){a.files=b.data},function(a){console.log(a)})}();a.showFile=function(){var c=e.msgDisplayFileRequest(a.file.selected.index);b.$broadcast(c.msg,c.data),a.file={}},a.fetchStaticFiles=function(){c.get("staticfiles/eiffelfiles.json").then(function(a){d.getProject().staticFiles=a.data},function(){})}()}]),app.controller("IdeFooterStatusBarCtrl",["$scope","$routeParams","UserSrv","ProjectFactory",function(a,b,c,d){a.getUsername=function(){var b="User: ";return b+=c.isAuthenticated()?c.getUsername():'#anonymous (<a href="'+a.signinSettings.signinPathWithRedirect()+'">sign in</a> to save your changes)'},a.getRole=function(){if(a.currentRoleIsOwner())return"Project owner";if(a.currentRoleIsUser())return"Project user";if(a.currentRoleIsAssistant())return"Project assistant";if(a.currentRoleIsSubmission()){var b="Inspection of a submission";return d.getProject().userBeingInspected&&(b='Inspecting submission from user "'+d.getProject().userBeingInspected+'"'),b}if(a.currentRoleIsUserProject()){var c="Inspection of a user's project";return d.getProject().userBeingInspected&&(c='Inspecting user-project from user "'+d.getProject().userBeingInspected+'"'),c}},a.isUsingLti=function(){return d.getProject().hasLtiData}}]);var app=angular.module("codeboardApp");app.controller("IdeNodeActionCtrl",["$scope","$rootScope","$uibModal","$log","IdeMsgService",function(a,b,c,d,e){var f={ADD_NODE_OPERATION:"add",RENAME_NODE_OPERATION:"rename",NODE_TYPE_FILE:"file",NODE_TYPE_FOLDER:"folder"},g=function(a,g,h,i){var j=["$scope","$uibModalInstance","data",function(a,b,c){a.data={nodeName:c.nodeName,nodeType:c.nodeType,operationType:c.operationType},a.labels={heading:"Add file",label:"Enter the name of the new file:",btnOk:"Add file",btnCancel:"Cancel"};!function(){c.operationType===f.RENAME_NODE_OPERATION?(a.labels.heading="Rename "+c.nodeType,a.labels.label="Enter a new name for "+c.nodeName+":",a.labels.btnOk="Rename "+c.nodeType):c.operationType===f.ADD_NODE_OPERATION&&(a.labels.heading="Add "+c.nodeType,a.labels.label="Enter the name of the new "+c.nodeType+":",a.labels.btnOk="Add "+c.nodeType)}();a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")},a.submit=function(b){a.data.nodeName=b.nodeName,a.ok()},a.isValid=function(){var b=/^[0-9a-zA-Z\-\_\.]+\.{1}[0-9a-zA-Z]{1,4}$/,c=/^[0-9a-zA-Z\-\_\.]+$/,d=b;return a.data.nodeType===f.NODE_TYPE_FOLDER&&(d=c),{test:function(a){return d.test(a)}}}(),a.getFormDataErrorMsg=function(){return a.data.nodeType===f.NODE_TYPE_FILE?"Filename format: only use characters a-Z, numbers 0-9, '.', '-', and '_'. Make sure to provide a filename extension. Example: My_File.txt":"Foldername format: only use characters a-Z, numbers 0-9, '.', '-', and '_'. Example: My_Folder"}}],k=c.open({templateUrl:"ideNewNodeModal.html",controller:j,size:"sm",resolve:{data:function(){return{nodeName:g,nodeType:h,operationType:i}}}});k.result.then(function(c){if(c.operationType===f.ADD_NODE_OPERATION){var d=e.msgNewNodeNameAvailable(c.nodeName,c.nodeType);b.$broadcast(d.msg,d.data)}else if(c.operationType===f.RENAME_NODE_OPERATION){var d=e.msgRenameNodeNameAvailable(a,c.nodeName);b.$broadcast(d.msg,d.data)}},function(){d.debug("Modal dismissed by user.")})};a.$on(e.msgNewNodeRequest().msg,function(a,b){var c="",d="file"===b.nodeType?f.NODE_TYPE_FILE:f.NODE_TYPE_FOLDER;g(-1,c,d,f.ADD_NODE_OPERATION)}),a.$on(e.msgDisplayRenameNodeModalRequest().msg,function(a,b){var c=b.nodeId,d=b.nodeName,e="file"===b.nodeType?f.NODE_TYPE_FILE:f.NODE_TYPE_FOLDER;g(c,d,e,f.RENAME_NODE_OPERATION)})}]),angular.module("codeboardApp").controller("usersAllCtrl",["$scope","$http","$q","$filter","$compile","DTOptionsBuilder","DTColumnBuilder",function(a,b,c,d,e,f,g){function h(b){e(angular.element(b).contents())(a)}function i(a,b,c){return'<img width="50" height="50" src="'+c.imageUrl+'">&nbsp <a ng-href="/users/'+c.username+'">'+c.username+"</a>"}function j(a,b,c){return d("date")(c.createdAt)}a.dtOptions=f.newOptions().withFnServerData(function(c,d,e){b({method:"GET",url:"/api/users",params:{start:d[3].value,length:d[4].value,draw:d[0].value,order:d[2].value,search:d[5].value,columns:d[1].value},headers:{"Content-type":"application/json"}}).then(function(b){var c={draw:b.data.draw,recordsTotal:b.data.count,recordsFiltered:b.data.count,data:b.data.rows};a.totalRecors=b.data.count,e(c)})}).withPaginationType("full_numbers").withOption("lengthMenu",[5,10,25,50,100]).withOption("iDisplayLength",10).withOption("processing",!0).withOption("createdRow",h).withOption("serverSide",!0),a.dtColumns=[g.newColumn("username").withTitle("Username").renderWith(i),g.newColumn("createdAt").withTitle("Joined").renderWith(j)]}]),angular.module("codeboardApp").controller("UserProjectsCtrl",["$scope","$rootScope","$routeParams","$http","$location","$route","UserSrv","userData",function(a,b,c,d,e,f,g,h){a.user={username:h.username,name:h.name,email:h.emailPublic,url:h.url,location:h.location,institution:h.institution,imageUrl:h.imageUrl,isSelf:g.isAuthenticated()&&h.username===g.getUsername()},a.display={isLoadingProjects:!0,isLoadingSubmissions:!0},a.ownerSet=[],a.assistantSet=[],a.userSet=[],a.init=function(){d.get("/api/users/"+c.username+"/projects").then(function(b){a.ownerSet=b.data.ownerSet,a.assistantSet=b.data.assistantSet,a.userSet=b.data.userSet,a.display.isLoadingProjects=!1},function(){e.path("/404").replace()})}(),a.getAllSubmissionsForUser=function(){d.get("/api/users/"+c.username+"/submissions").then(function(b){a.submissionData=b.data},function(a){console.log(a)})},a.filter={userInput:"",order:{selected:"createdAtNewFirst",property:"createdAt",isReversed:!0},accessLevel:{selected:"all"}},a.orderProjectCards=function(b){"updatedAtNewFirst"===b?(a.filter.order.selected=b,a.filter.order.property="updatedAt",a.filter.order.isReversed=!0):"updatedAtOldFirst"===b?(a.filter.order.selected=b,a.filter.order.property="updatedAt",a.filter.order.isReversed=!1):"projectname"===b?(a.filter.order.selected=b,a.filter.order.property="projectname",a.filter.order.isReversed=!1):"createdAtOldFirst"===b?(a.filter.order.selected=b,a.filter.order.property="createdAt",a.filter.order.isReversed=!1):(a.filter.order.selected=b,a.filter.order.property="createdAt",a.filter.order.isReversed=!0)},a.accessLevelFilter=function(b){a.filter.accessLevel.selected=b},a.projectFilterFunction=function(a){return function(b){if(a){var c=b.projectname.toLowerCase().indexOf(a.toLowerCase())>=0,d=b.language.toLowerCase().indexOf(a.toLowerCase())>=0;return c||d}return!0}},a.clearUserInputFilterOnEsc=function(b){b&&b.keyCode&&27==b.keyCode&&(a.filter.userInput="")},a.clearAllFilters=function(){a.filter.userInput="",a.filter.accessLevel.selected="all",angular.element("#userprojects-filter-userinput").focus()}}]),angular.module("codeboardApp").controller("projectsAllCtrl",["$scope","$http",function(a,b){a.data={count:0,projects:[],hasNext:!1,next:"/api/projects"},a.featuredData={projects:[]},a.searchString="",a.searchTerms=[];!function(){b.get("/api/projects").then(function(b){a.data=b.data},function(){}),b.get("/api/projects/featured").then(function(b){a.featuredData=b.data},function(){})}();a.submitSearch=function(c){var d=c.trim();d=d.replace(/\s+/g," "),b.get("/api/projects?search="+encodeURIComponent(d)).then(function(b){a.data.count=b.data.count,a.data.projects=b.data.projects,a.data.hasNext=b.data.hasNext,a.data.next=b.data.next},function(b){422===b.status&&""!==d&&(a.data.count=0,a.data.projects=[],a.data.hasNext=!1,a.data.next="/api/projects",a.searchTerms=b.data.searchTerms)})},a.showMore=function(){a.data.hasNext&&b.get(a.data.next).then(function(b){a.data.projects=a.data.projects.concat(b.data.projects),a.data.hasNext=b.data.hasNext,a.data.next=b.data.next},function(){})},a.display={search:!0,featured:!1},a.setDisplay=function(b){"search"===b&&(a.display.search=!0,a.display.featured=!1),"featured"===b&&(a.display.search=!1,a.display.featured=!0)}}]);var app=angular.module("codeboardApp");app.controller("ProjectSettingsCtrl",["$scope","$http","$log","$routeParams","$location","$timeout","$uibModal","ProjectRes","projectData",function(a,b,c,d,e,f,g,h,i){a.ui={submission:{isStartDateTimePickerOpen:!1,isEndDateTimePickerOpen:!1,datePickerOptions:{minDate:new Date("1970-01-02"),maxDate:new Date("2106-02-06")},timePickerOptions:{showMeridian:!1}}},a.data={projectId:-1,general:{projectname:"",description:"",language:"",equals:function(a){return this.projectname===a.projectname&&this.description===a.description&&this.language===a.language}},accessControl:{isPrivate:!0,ownerSet:[],userSet:[],assistantSet:[],_equalArrays:function(a,b){if(a.length!==b.length)return!1;for(var c=a.sort(),d=b.sort(),e=0;e<c.length;e++)if(c[e]!==d[e])return!1;return!0},equals:function(a){var b=this.isPrivate===a.isPrivate&&this._equalArrays(this.ownerSet,a.ownerSet)&&this._equalArrays(this.userSet,a.userSet)&&this._equalArrays(this.assistantSet,a.assistantSet);return b}},submission:{isSubmissionAllowed:!1,isSubmissionAcceptNonCompile:!1,isSubmissionPrintFeedback:!1,isSubmissionTimeRestricted:!1,submissionTimeRestrictionStart:new Date,submissionTimeRestrictionEnd:new Date,equals:function(a){var b=!0;return this.isSubmissionAllowed!==a.isSubmissionAllowed?b=!1:this.isSubmissionAllowed&&(this.isSubmissionAcceptNonCompile!==a.isSubmissionAcceptNonCompile?b=!1:this.isSubmissionPrintFeedback!==a.isSubmissionPrintFeedback?b=!1:this.isSubmissionTimeRestricted!==a.isSubmissionTimeRestricted?b=!1:this.submissionTimeRestrictionStart&&this.submissionTimeRestrictionEnd?(b=this.submissionTimeRestrictionStart.getTime()===a.submissionTimeRestrictionStart.getTime(),b=b&&this.submissionTimeRestrictionEnd.getTime()===a.submissionTimeRestrictionEnd.getTime()):b=!1),b}},lti:{isLtiAllowed:!1,ltiKey:"",ltiSecret:"",equals:function(a){return this.isLtiAllowed===a.isLtiAllowed&&this.ltiKey===a.ltiKey&&this.ltiSecret===a.ltiSecret}},setProjectId:function(a){this.projectId=a},setGeneral:function(a,b,c){this.general.projectname=a,this.general.description=b,this.general.language=c},getGeneral:function(){return{projectname:this.general.projectname,description:this.general.description,language:this.general.language}},setAccessControl:function(a,b,c,d){this.accessControl.isPrivate=a,this.accessControl.ownerSet=[],this.accessControl.userSet=[],this.accessControl.assistantSet=[];for(var e=0;e<b.length;e++)this.accessControl.ownerSet.push(b[e].username);for(var e=0;e<c.length;e++)this.accessControl.userSet.push(c[e].username);for(var e=0;e<d.length;e++)this.accessControl.assistantSet.push(d[e].username)},getAccessControl:function(){return{isPrivate:this.accessControl.isPrivate,ownerSet:this.accessControl.ownerSet,userSet:this.accessControl.userSet,assistantSet:this.accessControl.assistantSet}},setSubmission:function(a,b,c,d,e,f){this.submission.isSubmissionAllowed=a,this.submission.isSubmissionAcceptNonCompile=b,this.submission.isSubmissionPrintFeedback=c,this.submission.isSubmissionTimeRestricted=d,this.submission.submissionTimeRestrictionStart=0===e?new Date:new Date(e),this.submission.submissionTimeRestrictionEnd=new Date(0===e?Date.now()+2592e6:f)},getSubmission:function(){return{isSubmissionAllowed:this.submission.isSubmissionAllowed,isSubmissionAcceptNonCompile:this.submission.isSubmissionAcceptNonCompile,isSubmissionPrintFeedback:this.submission.isSubmissionPrintFeedback,isSubmissionTimeRestricted:this.submission.isSubmissionTimeRestricted,submissionTimeRestrictionStart:this.submission.submissionTimeRestrictionStart.getTime(),submissionTimeRestrictionEnd:this.submission.submissionTimeRestrictionEnd.getTime()}},setLti:function(a,b,c){this.lti.isLtiAllowed=a,this.lti.ltiKey=b,this.lti.ltiSecret=c},getLti:function(){return{isLtiAllowed:this.lti.isLtiAllowed,ltiKey:this.lti.ltiKey,ltiSecret:this.lti.ltiSecret}}},a.originalData={},a.cloneData={projectname:"",useCustomCloneSettings:!1,customCloneSettings:{isPrivate:!1,isNoOwners:!1,isNoUsers:!1,isNoAssistants:!1,isNoSubmission:!1,isNoLti:!1,isNoLtiSettings:!1}},a.projectId=d.projectId,a.server={saveSuccess:!1,saveFailure:!1,saveFailureMsg:"",cloneSuccess:!1,cloneFailure:!1,cloneFailureMsg:"",cloneUrl:"",deleteProjectFailure:!1,deleteProjectFailureMsg:""},a.actionDisabled={save:!1,discard:!1,deleteProject:!1,createClone:!1},a.userRole="unknown";!function(){a.data.setProjectId(i.id),a.data.setGeneral(i.projectname,i.description,i.language),a.data.setAccessControl(i.isPrivate,i.ownerSet,i.userSet,i.assistantSet),a.data.setSubmission(i.isSubmissionAllowed,i.isSubmissionAcceptNonCompile,i.isSubmissionPrintFeedback,i.isSubmissionTimeRestricted,i.submissionTimeRestrictionStart,i.submissionTimeRestrictionEnd),a.data.setLti(i.isLtiAllowed,i.ltiKey,i.ltiSecret),angular.copy(a.data,a.originalData),a.cloneData.projectname="Clone: "+a.data.general.projectname,a.userRole=i.userRole,"general"===e.hash().toLowerCase()?a.activeTab=0:"accesscontrol"===e.hash().toLowerCase()?a.activeTab=1:"submission"===e.hash().toLowerCase()?a.activeTab=2:"lti"===e.hash().toLowerCase()?a.activeTab=3:"cloning"===e.hash().toLowerCase()?a.activeTab=4:"deletion"===e.hash().toLowerCase()&&(a.activeTab=5)}();a.input={},a.addOwners=function(b){a.data.accessControl.ownerSet=j(a.data.accessControl.ownerSet,b),a.input.newOwner=""},a.addAssistants=function(b){a.data.accessControl.assistantSet=j(a.data.accessControl.assistantSet,b),a.input.newAssistant=""},a.addUsers=function(b){a.data.accessControl.userSet=j(a.data.accessControl.userSet,b),a.input.newUser=""};var j=function(a,b){for(var c=b.split(","),d=[],e=0;e<c.length;e++){var f=c[e].trim();f.length>0&&d.push(f)}var g=function(a,b){return a.username<b.username?-1:a.username>b.username?1:0};return a.concat(d).sort(g)};a.removeMember=function(a,b){var c=-1;for(var d in a)a[d]===b&&(c=d);a.splice(c,1)},a.discardChanges=function(a,b){angular.copy(a,b)},a.save=function(c,e,g){var h=d.projectId;if(c.$valid){var i=e;a.server.saveSuccess=!1,a.server.saveFailure=!1,a.actionDisabled.save=!0,a.actionDisabled.discard=!0,b.put("/api/projects/"+h+"/settings",i).then(function(){a.server.saveSuccess=!0,f(function(){a.server.saveSuccess=!1},2e3),a.cloneData.projectname==="Clone: "+a.originalData.general.projectname&&(a.cloneData.projectname="Clone: "+a.data.general.projectname),angular.copy(a.data[g],a.originalData[g]),a.actionDisabled.save=!1,a.actionDisabled.discard=!1},function(b){a.server.saveFailure=!0,a.server.saveFailureMsg=b.data.msg,f(function(){a.server.saveFailure=!1},5e3),a.actionDisabled.save=!1,a.actionDisabled.discard=!1})}},a.deleteProject=function(){a.actionDisabled.deleteProject=!0,h.remove({projectId:d.projectId},function(){c.debug("Deletion ok"),a.actionDisabled.deleteProject=!1,e.url("/")},function(b){c.debug("Deletion failed"),a.server.deleteProjectFailureMsg=b.data.msg,a.server.deleteProjectFailure=!0,f(function(){a.server.deleteProjectFailure=!1},9e3),f(function(){a.actionDisabled.deleteProject=!1},1500)})},a.createClone=function(c,d){c.$valid&&(a.server.cloneSuccess=!1,a.server.cloneFailure=!1,a.actionDisabled.createClone=!0,b.post("/api/projects/"+d+"/settings/clones",a.cloneData).then(function(b){a.server.cloneUrl="/projects/"+b.data.projectId+"/summary",a.server.cloneSuccess=!0,f(function(){a.server.cloneSuccess=!1},9e3),f(function(){a.actionDisabled.createClone=!1},1500)},function(b){a.server.cloneFailureMsg=b.data.msg,a.server.cloneFailure=!0,f(function(){a.server.cloneFailure=!1},5e3),f(function(){a.actionDisabled.createClone=!1},1500)}))},a.currentRoleIsOwner=function(){return"owner"===a.userRole},a.currentRoleIsAssistant=function(){return"assistant"===a.userRole}}]),angular.module("codeboardApp").controller("ProjectSummaryCtrl",["$scope","$http","$log","$routeParams","$location","projectSummaryData","UserSrv",function(a,b,c,d,e,f,g){a.prj=f,a.isCurrentUserProjectOwner=function(){return g.isAuthenticated()&&f.ownerSet.some(function(a){return a.username===g.getUsername()})}}]),angular.module("codeboardApp").controller("ProjectNewCtrl",["$scope","$http","$routeParams","$location","$route","$timeout",function(a,b,c,d){a.data={language:"Java-JUnit"},a.server={saveSuccess:!1,saveFailure:!1},a.save=function(e){c.projectId;if(e.$valid){var f={projectname:a.data.projectname,description:a.data.description,language:a.data.language,isPrivate:a.data.isPrivate};a.server.saveSuccess=!1,a.server.saveFailure=!1,b.post("/api/projects/",f).then(function(b){a.server.saveSuccess=!0,d.path("/projects/"+b.data.id+"/summary")},function(){a.server.saveFailure=!0})}}}]),angular.module("codeboardApp").controller("ProjectStatsCtrl",["$scope","$log","$route","$http","StatsSrv",function(a,b,c,d,e){a.fromDate=new Date,a.fromDate.setMonth(a.fromDate.getMonth()-1),a.untilDate=new Date,a.datePickerMaxSelectableDate=new Date,a.datePickerDateFormat="dd-MMMM-yyyy",a.datePickerFromOpen=!1,a.datePickerUntilOpen=!1,a.projectId=c.current.params.projectId,a.isLoadingCompilationRunGraphData=!0,a.isLoadingUserAccessGraphData=!0,a.compilationRunTableVisible=!1,a.projectAccessTableVisible=!1,a.submissionTableVisible=!1,a.isLoadingCompilationRunDetails=!1,a.isLoadingProjectAccessDetails=!1,a.isLoadingSubmissionsDetails=!1,a.compilationRunBtnLabel="Show user details",a.projectAccessBtnLabel="Show user details",a.submissionBtnLabel="Show user details",a.openDatePickerFrom=function(b){b.preventDefault(),b.stopPropagation(),a.datePickerFromOpen=!0},a.openDatePickerUntil=function(b){b.preventDefault(),b.stopPropagation(),a.datePickerUntilOpen=!0},a.updateFromDate=function(){a.fromDate>a.untilDate&&(a.untilDate=new Date(a.fromDate)),q()},a.updateUntilDate=function(){a.fromDate>a.untilDate&&(a.fromDate=new Date(a.untilDate)),q()};var f=function(a,b){var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=1;a.length>20&&(d=Math.ceil(a.length/20));for(var e=0;e<a.length;e++)b.labels.push(e%d===0?c[a[e]._id.month-1]+" "+a[e]._id.day:"")},g=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d].count);b.data.push(c)},h=function(){a.compileRunGraph={labels:[],series:[],data:[]},e.sortAndAddMissingDates(a.fromDate,a.untilDate,a.compilerSummaryLogs),e.sortAndAddMissingDates(a.fromDate,a.untilDate,a.compilerSummaryRunLogs),a.compileRunGraph.series.push("Compilations"),g(a.compilerSummaryLogs,a.compileRunGraph),a.compileRunGraph.series.push("Runs"),g(a.compilerSummaryRunLogs,a.compileRunGraph),f(a.compilerSummaryLogs,a.compileRunGraph)},i=function(){a.dataGraphUserAccess={labels:[],series:[],data:[]},e.sortAndAddMissingDates(a.fromDate,a.untilDate,a.projectAccessPerDay),a.dataGraphUserAccess.series.push("Project accesses"),g(a.projectAccessPerDay,a.dataGraphUserAccess),f(a.projectAccessPerDay,a.dataGraphUserAccess)},j=function(){a.isLoadingCompilationRunGraphData=!0;var e=c.current.params.projectId;d.get("/api/log/user/summaryProjectCompilationRunDay/"+e,{params:{startDateLogs:a.fromDate,endDateLogs:a.untilDate}}).then(function(b){a.compilerSummaryLogs=b.data.compilerLogs,a.compilerSummaryRunLogs=b.data.compilerRunLogs,a.totalCompilationsDay="("+m(a.compilerSummaryLogs,"count")+")",a.totalRunsDay="("+m(a.compilerSummaryRunLogs,"count")+")",h(),a.isLoadingCompilationRunGraphData=!1},function(){b.debug("Unable to get compile and run logs statistics (summary per day).")})},k=function(){a.isLoadingUserAccessGraphData=!0;var b=c.current.params.projectId;d.get("/api/log/user/summaryProjectAccessDay/"+b,{params:{startDateLogs:a.fromDate,endDateLogs:a.untilDate}}).then(function(b){a.projectAccessPerDay=b.data.projectAccessPerDay,a.totalAccessPerDay="("+m(a.projectAccessPerDay,"count")+")",i(),a.isLoadingUserAccessGraphData=!1},function(){})};a.hideShowCompilationRunTable=function(){a.compilationRunTableVisible=!a.compilationRunTableVisible,a.compilationRunTableVisible?(a.compilationRunBtnLabel="Hide user details",n()):a.compilationRunBtnLabel="Show user details"},a.hideShowProjectAccessDetails=function(){a.projectAccessTableVisible=!a.projectAccessTableVisible,a.projectAccessTableVisible?(a.projectAccessBtnLabel="Hide user details",o()):a.projectAccessBtnLabel="Show user details"},a.hideShowSubmissionsDetails=function(){a.submissionTableVisible=!a.submissionTableVisible,a.submissionTableVisible?(a.submissionBtnLabel="Hide user details",p()):a.submissionBtnLabel="Show user details"},a.currentPageProjectAccess=0,a.currentPageCompilations=0,a.currentPageRuns=0,a.currentPageSubmissions=0,a.numPerPage=10,a.maxSizePage=10,a.filteredProjAccesses=[],a.filteredCompilations=[],a.filteredRuns=[],a.filteredSubmissions=[],a.pageChanged=function(b,c){var d=(b-1)*a.numPerPage,e=d+a.numPerPage;return void 0!=c?c.slice(d,e):[]},a.pageCompilationChanged=function(){a.filteredCompilations=a.pageChanged(a.currentPageCompilations,a.compilationStats)},a.pageRunsChanged=function(){a.filteredRuns=a.pageChanged(a.currentPageRuns,a.runStats)},a.pageProjectAccessChanged=function(){a.filteredProjAccesses=a.pageChanged(a.currentPageProjectAccess,a.accessStats)},a.pageSubmissionsChanged=function(){a.filteredSubmissions=a.pageChanged(a.currentPageSubmissions,a.submissionStats)};var l=function(a){a.sort(function(a,b){return a._id<b._id?-1:a._id>b._id?1:0})},m=function(a,b){for(var c=0,d=0;d<a.length;d++)c+=a[d][b];return c},n=function(){a.isLoadingCompilationRunDetails=!0;var e=c.current.params.projectId;d.get("/api/log/user/summaryCompiler/"+e,{params:{startDateLogs:a.fromDate,endDateLogs:a.untilDate}}).then(function(b){a.compilationStats=b.data.compilerLogs,a.runStats=b.data.compilerRunLogs,a.totalCompilations=m(a.compilationStats,"countProjectAccess"),a.totalRuns=m(a.runStats,"countProjectAccess"),l(a.compilationStats),l(a.runStats),a.currentPageCompilations=1,a.pageCompilationChanged(),a.currentPageRuns=1,a.pageRunsChanged(),a.isLoadingCompilationRunDetails=!1},function(){b.debug("Unable to get Compile and Run statistics.")})},o=function(){a.isLoadingProjectAccessDetails=!0;var e=c.current.params.projectId;d.get("/api/log/user/summaryProjectAccess/"+e,{params:{startDateLogs:a.fromDate,endDateLogs:a.untilDate}}).then(function(b){a.accessStats=b.data.projectAccess,a.totalAccesses=m(a.accessStats,"countProjectAccess"),l(a.accessStats),a.currentPageProjectAccess=1,a.pageProjectAccessChanged(),a.isLoadingProjectAccessDetails=!1},function(){b.debug("Unable to get Project Access statistics.")})},p=function(){a.isLoadingSubmissionsDetails=!0;var e=c.current.params.projectId;d.get("/api/log/user/summarySubmitAccess/"+e,{params:{startDateLogs:a.fromDate,endDateLogs:a.untilDate}}).then(function(b){a.submissionStats=b.data.submitLogs,a.totalSubmissions=m(a.submissionStats,"countProjectAccess"),l(a.submissionStats),a.currentPageSubmissions=1,a.pageSubmissionsChanged(),a.isLoadingSubmissionsDetails=!1},function(){b.debug("Unable to get Submission statistics.")})},q=function(){a.fromDate&&a.untilDate&&(j(),k(),a.compilationRunTableVisible&&n(),a.projectAccessTableVisible&&o(),a.submissionTableVisible&&p())};q()}]),angular.module("codeboardApp").controller("ProjectSubmissionsCtrl",["$scope","$log","$routeParams","$http","$timeout","$window","$location","AuthorizedUser",function(a,b,c,d,e,f,g,h){a.usernameFilter=void 0,a.projectId=c.projectId,a.display={isLoadingSubmissions:!0,isDownloadingAllSubmissions:!1},a.submissionData=[];!function(){var e=c.projectId;d.get("/api/projects/"+e+"/submissions").then(function(b){a.submissionData=b.data,a.display.isLoadingSubmissions=!1},function(){b.debug("Can not get the submissions"),a.display.isLoadingSubmissions=!1})}();a.currentUserIsOwner=function(){return"owner"===h.data.userRole},a.downloadSubmissions=function(c){var g=e(function(){a.display.isDownloadingAllSubmissions=!0},500);d.get("/api/projects/"+c+"/submissions/downloads").then(function(a){b.debug("Downloading the submissions"),f.open(a.data.downloadUrl,"_self")},function(){b.debug("Can not get the download link for submissions")})["finally"](function(){e.cancel(g),a.display.isDownloadingAllSubmissions=!1})}}]),angular.module("codeboardApp").controller("ProjectUserProjectsCtrl",["$scope","$log","$routeParams","$http",function(a,b,c,d){a.usernameFilter=void 0,a.projectId=c.projectId,a.display={isLoadingUserVersions:!0},a.userProjects=[];!function(){var e=c.projectId;d.get("/api/projects/"+e+"/userprojects").then(function(b){a.userProjects=b.data,a.display.isLoadingUserVersions=!1},function(){b.debug("Can not get the userprojects"),a.display.isLoadingUserVersions=!1})}()}]),angular.module("codeboardApp").controller("DocumentationCtrl",["$scope","$http","$routeParams","$location","$route","$anchorScroll",function(a,b,c,d,e,f){a.docs={project:{isOpen:!1},user:{isOpen:!1},ide:{isOpen:!1},submission:{isOpen:!1},lti:{isOpen:!1},faq:{isOpen:!1},video:{isOpen:!1}};!function(){c.docId&&a.docs[c.docId]&&(a.docs[c.docId].isOpen=!0)}();a.getUrlOfPartial=function(){return c.docId&&a.docs[c.docId]?"partials/docs/"+c.docId+".html":"partials/404.html"},a.gotoAnchor=function(a){d.hash()===a&&f()}}]),angular.module("codeboardApp").controller("LegalCtrl",["$scope","$routeParams","$location","$anchorScroll",function(a,b,c,d){a.getUrlOfPartial=function(){return b.docId?"partials/legal/"+b.docId+".html":"partials/404.html"},a.gotoAnchor=function(a){c.hash()===a&&d()}}]),angular.module("codeboardApp").filter("arrayToString",function(){return function(a){switch(a){case"1":return"successful user creation";case"2":return"fail user creation";case"3":return"sign in";case"4":return"failed sign in";case"5":return"sign out";case"6":return"create project";case"7":return"failed create project";case"8":return"modify project";case"9":return"open a full project";case"10":return"open non existing project";case"11":return"open limited project";case"12":return"access user profile";case"13":return"update user profile";case"14":return"access project profile";case"15":return"update project profile";case"16":return"submit solution";default:return a}}}).filter("arrayToDate",function(){return function(a){return new Date(a.year,a.month-1,a.day)}}).filter("arrayToDateTime",function(){return function(a){return new Date(a.year,a.month-1,a.day,a.hour)}}).controller("LogsCtrl",["$scope","$http","$routeParams","$location","StatsSrv",function(a,b,c,d,e){a.userAccessProjectId="ALL",a.dataGraphLanguagesColours=["0040FF","DF0101","088A08","#FFFF00","FF00FF","#FF8000","#01DFD7","#58ACFA","#FF8A80"],a.compilationErrors={},a.compilationErrors.normal=0,a.compilationErrors.slow=0,a.compilationErrors.tooSlow=0,a.compilationErrors.error=0;var f=new Date;a.startDateLogs=1==f.getMonth()?new Date(f.getFullYear()-1,11,f.getDay()):new Date(f.getFullYear(),f.getMonth()-1,f.getDay()),a.endDateLogs=new Date,a.maxDateLogs=new Date,a.formatDateLogs="dd-MMMM-yyyy",a.dateLogsOpenedStart=!1,a.dateLogsOpenedEnd=!1,a.openStart=function(b){b.preventDefault(),b.stopPropagation(),a.dateLogsOpenedStart=!0},a.openEnd=function(b){b.preventDefault(),b.stopPropagation(),a.dateLogsOpenedEnd=!0},a.updateDateStart=function(){a.startDateLogs>a.endDateLogs&&(a.endDateLogs=new Date(a.startDateLogs)),a.updateGraphs()},a.updateDateEnd=function(){a.startDateLogs>a.endDateLogs&&(a.startDateLogs=new Date(a.endDateLogs)),a.updateGraphs()},a.clear=function(){a.startDateLogs=new Date,a.endDateLogs=new Date},a.sortAndAddMissingLanguages=function(a){function b(a,b){for(var c=0;c<a.length;c++)if(a[c]._id===b)return c;return-1}function c(c){-1==b(a,c)&&a.push({_id:c,count:0})}c("C"),c("C++"),c("Eiffel"),c("Haskell"),c("Haskell-HSpec"),c("Infer-Java"),c("Java"),c("Java-JUnit"),c("Python"),c("Python-UnitTest"),a.sort(function(a,b){return a._id<b._id?-1:a._id>b._id?1:0})},Date.prototype.addDays=function(a){var b=new Date(this.valueOf());return b.setDate(b.getDate()+a),b},a.createLanguageGraph=function(a,b){for(var c=[],d=0;d<a.length;d++)b.data.push(a[d].count),b.labels.push(a[d]._id),b.total=b.total+a[d].count;b.data.push(c)},a.drawGraphLanguagesCompilationOnlySummary=function(){a.dataGraphLanguagesCompilationOnly={},a.dataGraphLanguagesCompilationOnly.labels=[],a.dataGraphLanguagesCompilationOnly.data=[],a.dataGraphLanguagesCompilationOnly.total=0,a.sortAndAddMissingLanguages(a.languageCompilationLogs),a.createLanguageGraph(a.languageCompilationLogs,a.dataGraphLanguagesCompilationOnly)},a.drawGraphLanguagesRunOnlySummary=function(){a.dataGraphLanguagesRunOnly={},a.dataGraphLanguagesRunOnly.labels=[],a.dataGraphLanguagesRunOnly.data=[],a.dataGraphLanguagesRunOnly.total=0,a.sortAndAddMissingLanguages(a.languageRunLogs),a.createLanguageGraph(a.languageRunLogs,a.dataGraphLanguagesRunOnly)},a.drawGraphLanguagesSummary=function(){a.dataGraphLanguages={},a.dataGraphLanguagesColours=["#4D4D4D","#5DA5DA","#FAA43A","#60BD68","#F17CB0","#B2912F","#B276B2","#DECF3F","#F15854","#6600ff"],a.dataGraphLanguages.labels=[],a.dataGraphLanguages.series=["compilation and run per programming language"],a.dataGraphLanguages.data=[],a.dataGraphLanguages.total=0,a.sortAndAddMissingLanguages(a.projectPerLanguage),a.createLanguageGraph(a.projectPerLanguage,a.dataGraphLanguages)};var g=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d].count);b.data.push(c)},h=function(a,b){var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=1;a.length>20&&(d=Math.ceil(a.length/20));for(var e=0;e<a.length;e++)b.labels.push(e%d==0?c[a[e]._id.month-1]+" "+a[e]._id.day:"")};a.drawGraphUserAccessSummary=function(){a.dataGraphUserAccess={},a.dataGraphUserAccess.labels=[],a.dataGraphUserAccess.series=["user access per day"],a.dataGraphUserAccess.data=[],e.sortAndAddMissingDates(a.startDateLogs,a.endDateLogs,a.projectAccessPerDay),g(a.projectAccessPerDay,a.dataGraphUserAccess),h(a.projectAccessPerDay,a.dataGraphUserAccess)},a.drawGraphActiveProjectSummary=function(){a.dataGraphActiveProject={},a.dataGraphActiveProject.labels=[],a.dataGraphActiveProject.series=["active projects per day"],a.dataGraphActiveProject.data=[],e.sortAndAddMissingDates(a.startDateLogs,a.endDateLogs,a.activeProjectPerDay),g(a.activeProjectPerDay,a.dataGraphActiveProject),h(a.activeProjectPerDay,a.dataGraphActiveProject)},a.chartOptions={pointHitDetectionRadius:1},a.drawGraphToolSummary=function(){a.dataGraphTool={},a.dataGraphTool.labels=[],a.dataGraphTool.series=["tool actions per day"],a.dataGraphTool.data=[],e.sortAndAddMissingDates(a.startDateLogs,a.endDateLogs,a.compilerSummaryToolLogs),g(a.compilerSummaryToolLogs,a.dataGraphTool),h(a.compilerSummaryToolLogs,a.dataGraphTool)},a.drawGraphTestSummary=function(){a.dataGraphTest={},a.dataGraphTest.labels=[],a.dataGraphTest.series=["test actions per day"],a.dataGraphTest.data=[],e.sortAndAddMissingDates(a.startDateLogs,a.endDateLogs,a.compilerSummaryTestLogs),g(a.compilerSummaryTestLogs,a.dataGraphTest),h(a.compilerSummaryTestLogs,a.dataGraphTest)},a.drawGraphRunSummary=function(){a.dataGraphRun={},a.dataGraphRun.labels=[],a.dataGraphRun.series=["runs per day"],a.dataGraphRun.data=[],e.sortAndAddMissingDates(a.startDateLogs,a.endDateLogs,a.compilerSummaryRunLogs),g(a.compilerSummaryRunLogs,a.dataGraphRun),h(a.compilerSummaryRunLogs,a.dataGraphRun)},a.drawGraphCompilationSummary=function(){a.dataGraphCompilation={},a.dataGraphCompilation.labels=[],a.dataGraphCompilation.series=["Compilations per day"],a.dataGraphCompilation.data=[],e.sortAndAddMissingDates(a.startDateLogs,a.endDateLogs,a.compilerSummaryLogs),g(a.compilerSummaryLogs,a.dataGraphCompilation),h(a.compilerSummaryLogs,a.dataGraphCompilation)},a.getUserAccessSummary=function(){"ALL"==a.userAccessProjectId?(b.get("/api/log/user/summaryCompiler").success(function(b){a.compilerUserSummaryLogs=b.compilerLogs,a.compilerUserSummaryRunLogs=b.compilerRunLogs
}).error(function(){d.url("/401")}),b.get("/api/log/user/summaryProjectAccess").success(function(b){a.projectAccess=b.projectAccess}).error(function(){d.url("/401")}),b.get("/api/log/user/summarySubmitAccess").success(function(b){a.submitUserSummaryLogs=b.submitLogs}).error(function(){d.url("/401")})):(a.compilerUserSummaryLogs=[],a.compilerUserSummaryRunLogs=[],a.projectAccess=[],b.get("/api/log/user/summaryCompiler/"+a.userAccessProjectId).success(function(b){a.compilerUserSummaryLogs=b.compilerLogs,a.compilerUserSummaryRunLogs=b.compilerRunLogs}).error(function(){d.url("/401")}),b.get("/api/log/user/summaryProjectAccess/"+a.userAccessProjectId).success(function(b){a.projectAccess=b.projectAccess}).error(function(){d.url("/401")}),b.get("/api/log/user/summarySubmitAccess/"+a.userAccessProjectId).success(function(b){a.submitUserSummaryLogs=b.submitLogs}).error(function(){d.url("/401")}))},a.getProjectAccessPerDay=function(){a.isLoadingUserAccess=!0,b.get("/api/log/projectAccessDay",{params:{startDateLogs:a.startDateLogs,endDateLogs:a.endDateLogs}}).success(function(b){a.projectAccessPerDay=b.projectAccessPerDay,a.projectAccessPerDay.sort(function(a,b){return new Date(a._id.year,a._id.month-1,a._id.day)-new Date(b._id.year,b._id.month-1,b._id.day)}),a.drawGraphUserAccessSummary(),a.isLoadingUserAccess=!1}).error(function(){d.url("/401")})},a.getActiveProjectPerDay=function(){a.isLoadingActiveProjects=!0,b.get("/api/log/activeProjectAccessDay",{params:{startDateLogs:a.startDateLogs,endDateLogs:a.endDateLogs}}).success(function(b){a.activeProjectPerDay=b.activeProjectPerDay,a.activeProjectPerDay.sort(function(a,b){return new Date(a._id.year,a._id.month-1,a._id.day)-new Date(b._id.year,b._id.month-1,b._id.day)}),a.drawGraphActiveProjectSummary(),a.isLoadingActiveProjects=!1}).error(function(){d.url("/401")})},a.isLoadingCompilation=!1,a.getCompilationSummaryPerDay=function(){a.isLoadingCompilation=!0,a.isLoadingRun=!0,a.isLoadingTest=!0,a.isLoadingTool=!0,b.get("/api/log/summaryDay",{params:{startDateLogs:a.startDateLogs,endDateLogs:a.endDateLogs}}).success(function(b){a.compilerSummaryLogs=b.compilerLogs,a.compilerSummaryRunLogs=b.compilerRunLogs,a.compilerSummaryTestLogs=b.compilerTestLogs,a.compilerSummaryToolLogs=b.compilerToolLogs,a.drawGraphCompilationSummary(),a.isLoadingCompilation=!1,a.drawGraphRunSummary(),a.isLoadingRun=!1,a.drawGraphTestSummary(),a.isLoadingTest=!1,a.drawGraphToolSummary(),a.isLoadingTool=!1}).error(function(){d.url("/401")})},a.getSummaryLanguagesPerLanguage=function(){a.isLoadingProgrammingLanguages=!0,b.get("/api/log/summaryLanguages",{params:{startDateLogs:a.startDateLogs,endDateLogs:a.endDateLogs}}).success(function(b){a.projectPerLanguage=b.languageLogs,a.languageRunLogs=b.languageRunLogs,a.languageCompilationLogs=b.languageCompilationLogs,a.drawGraphLanguagesSummary(),a.drawGraphLanguagesCompilationOnlySummary(),a.drawGraphLanguagesRunOnlySummary(),a.isLoadingProgrammingLanguages=!1}).error(function(){d.url("/401")})},a.getSummaryCompilationErrors=function(){b.get("/api/log/summaryCompilationErrors",{params:{startDateLogs:a.startDateLogs,endDateLogs:a.endDateLogs}}).success(function(b){a.compilationErrors.normal=b.normal,a.compilationErrors.slow=b.slow,a.compilationErrors.tooSlow=b.tooSlow,a.compilationErrors.error=b.error}).error(function(){d.url("/401")})},a.getSummaryPerDay=function(){a.detailsDay=!0,a.detailsDayButtonEnable=!1},a.getDetailsUserAccess=function(){a.detailsUserAccess=!0,a.detailsUserAccessButtonEnable=!1,a.getUserAccessSummary()},a.compilerLogs=[],a.pageLogs=[],a.LogLimit=50,a.detailsDay=!1,a.detailsLogs=!1,a.detailsDayButtonEnable=!0,a.detailsUserAccess=!1,a.detailsUserAccessButtonEnable=!0,a.getFullCompilationLogs=function(){b.get("/api/logLimit/"+a.LogLimit).success(function(b){a.detailsLogs=!0,a.LogLimit=a.LogLimit+100,a.compilerLogs=b.compilerLogs,a.pageLogs=b.pageLogs}).error(function(){d.url("/401")})},a.orderPropComp="startTime",a.orderPropPage="date",a.getPopularProjects=function(){a.isLoadingPopularProjects=!0,b.get("/api/log/popularProjects",{params:{startDateLogs:a.startDateLogs,endDateLogs:a.endDateLogs,limit:50}}).success(function(b){a.popularProjects=b.popularProjects,a.isLoadingPopularProjects=!1}).error(function(){d.url("/401")})},a.updateGraphs=function(){a.getCompilationSummaryPerDay(),a.getProjectAccessPerDay(),a.getSummaryLanguagesPerLanguage(),a.getSummaryCompilationErrors(),a.getPopularProjects(),a.getActiveProjectPerDay()},a.updateGraphs()}]),angular.module("codeboardApp").controller("SupportCtrl",["$scope","$rootScope","$http","$routeParams","$location",function(a,b,c,d){a.data={initialReqBody:"",outcomeServiceUrl:"",sourcedId:"",replaceResultResponseHeader:"",replaceResultResponseStatusCode:-1,replaceResultResponseBody:""},a.input={gradeValue:"1.0"};!function(){if(d.reqBody){var b=JSON.parse(decodeURIComponent(d.reqBody)),c="";for(var e in b)c=c+e+"="+b[e]+"\n";a.data.initialReqBody=c,a.data.outcomeServiceUrl=b.lis_outcome_service_url,a.data.sourcedId=b.lis_result_sourcedid}}();a.sendGrade=function(b){var d={grade:b,lis_outcome_service_url:a.data.outcomeServiceUrl,lis_result_sourcedid:a.data.sourcedId};c.put("/support/lti/debug/outcome",d).then(function(b){a.data.replaceResultResponseStatusCode=b.data.statusCode,a.data.replaceResultResponseHeader=b.data.headers,a.data.replaceResultResponseBody=vkbeautify.xml(JSON.parse(b.data.body))},function(){})},a.getDataForEmail=function(){var b="";return b+="PLEASE FILL IN:\n",b+="Your personal message here\n\n",b+="PLEASE FILL IN:\n",b+="LTI Tool Consumer used (e.g. Moodle, edX, openedX, D2L, etc.): FILL IN HERE\n",b+="\n\n\n",b+="### All information below this point was automatically generated. Do not modify it. ###\n\n",b+="--LTI TC initial request--\n\n",b+=a.data.initialReqBody+"\n",b+="\n\n",b+="--Extracted TC details--\n\n",b+="OutcomeServiceUrl:\n"+a.data.outcomeServiceUrl+"\n",b+="SourceId:\n"+a.data.sourcedId+"\n",b+="\n\n",b+="--LTI TP sending grade--\n\n",b+="Grade value: "+a.input.gradeValue+"\n",b+="\n\n",b+="--LTI TC replace result response--\n\n",b+="HTTP status code:\n",b+=a.data.replaceResultResponseStatusCode+"\n\n",b+="Header:\n",b+=a.data.replaceResultResponseHeader+"\n\n",b+="Body:\n",b+=a.data.replaceResultResponseBody+"\n",b+="\n\n",encodeURIComponent(b)}}]),angular.module("codeboardApp").controller("UserSettingsCtrl",["$scope","$upload","$routeParams","$http","$timeout","$log","UserResSettings","userData",function(a,b,c,d,e,f,g,h){a.profileModel={imageUrl:h.imageUrl,emailPublic:h.emailPublic,name:h.name,url:h.url,institution:h.institution,location:h.location},a.emailModel={email:h.email,isEmailVerified:h.isEmailVerified,originalEmail:h.email};var i=angular.copy(a.profileModel),j=angular.copy(a.emailModel);a.server={saveSuccess:!1,saveFailure:!1,saveFailureMsg:""},a.serverEmail={saveSuccess:!1,saveFailure:!1,saveFailureMsg:""},a.disableBtn={save:!1,discard:!1},a.discardChanges=function(b){"profileForm"===b.$name&&(a.profileModel=angular.copy(i),a.server.saveFailure=!1,a.server.saveSuccess=!1),"emailForm"===b.$name&&(a.emailModel=angular.copy(j),a.serverEmail.saveSuccess=!1,a.serverEmail.saveFailure=!1),b.$setPristine(),b.$setUntouched()},a.savePublicProfile=function(b,d){if(d.$valid){a.server.saveSuccess=!1,a.server.saveFailure=!1,a.disableBtn.save=!0,a.disableBtn.discard=!0;var f={emailPublic:b.emailPublic,name:b.name,url:b.url,institution:b.institution,location:b.location};g.update({username:c.username},f).$promise.then(function(){return a.server.saveSuccess=!0,d.$setPristine(),d.$setUntouched(),i=angular.copy(a.profileModel),e(function(){a.server.saveSuccess=!1},4e3),!1},function(b){return a.server.saveFailureMsg=422===b.status&&b.data&&b.data.msg?b.data.msg:"Please try again. If the problem persists, contact support.",a.server.saveFailure=!0,!1}).then(function(){a.disableBtn.save=!1,a.disableBtn.discard=!1})}},a.onFileSelect=function(d){for(var e=0;e<d.length;e++){{d[e]}a.upload=b.upload({url:"/api/users/"+c.username+"/settings/userImage",data:{myObj:a.myModelObj},file:d}).progress(function(){}).success(function(b){a.profileModel.imageUrl=b.imageUrl})}},a.saveEmail=function(b,f){if(f.$valid){a.serverEmail.saveSuccess=!1,a.serverEmail.saveFailure=!1,a.disableBtn.save=!0,a.disableBtn.discard=!0;var g={username:h.username,email:b.email};d.put("/api/users/"+c.username+"/settings/email",g).then(function(b){return a.emailModel.email=b.data.email,a.emailModel.isEmailVerified=b.data.isEmailVerified,a.emailModel.originalEmail=b.data.email,a.serverEmail.saveSuccess=!0,f.$setPristine(),f.$setUntouched(),j=angular.copy(a.emailModel),e(function(){a.serverEmail.saveSuccess=!1},5e3),!0},function(b){return a.serverEmail.saveFailure=!0,a.serverEmail.saveFailureMsg=b.data.msg?b.data.msg:"This email can't be used. Please provide a different email.",!1}).then(function(){a.disableBtn.save=!1,a.disableBtn.discard=!1})}},a.resend={label:"Resend verification email",disabled:!1},a.resendVerificationEmail=function(){a.resend.label="Processing ...",a.resend.disabled=!0,d.get("/api/users/"+c.username+"/settings/email/verificationemail").then(function(){return a.resend.label="Email sent ...",!0},function(){return console.error("Error while send request to resend verification email."),a.resend.label="Problem sending an Email. Please try again.",!1}).then(function(){e(function(){a.resend.label="Resend verification email",a.resend.disabled=!1},2500)})}}]),angular.module("codeboardApp").controller("UserSettingsPasswordCtrl",["$scope","$routeParams","$http","$timeout","$log",function(a,b,c,d,e){a.passwordSubmitted=!1,a.invalidCurrentPassword=!1,a.pserver={saveSuccess:!1,saveFailure:!1},a.updatePassword=function(f){if(a.pserver.saveSuccess=!1,a.pserver.saveFailure=!1,a.invalidCurrentPassword=!1,a.passwordSubmitted=!0,a.changePasswordForm.$valid&&f.newPassword===f.newPasswordConfirm){var g={currentPassword:f.currentPassword,newPassword:f.newPassword};c.put("/api/users/"+b.username+"/settings/password",g).then(function(){a.pserver.saveSuccess=!0,a.formModel={},a.passwordSubmitted=!1,d(function(){a.pserver.saveSuccess=!1},8e3)},function(b){e.debug(b.status+" error:"+b.data.msg),a.pserver.saveFailure=!0,403===b.status&&(a.invalidCurrentPassword=!0)})}}}]),angular.module("codeboardApp").controller("UserAccountDeletionCtrl",["$scope","$routeParams","$http","$timeout","$log","$uibModal","UserSrv","UserRes",function(a,b,c,d,e,f,g,h){a.deleteAccountModel={password:""},a.state={isInFlightReq:!1,submitted:!0,username:g.getUsername()},a.serverError={invalidPassword:!1,message:""},a.deleteAccount=function(){if(!a.state.isInFlightReq){a.state.isInFlightReq=!0,a.state.submitted=!0,a.serverError.invalidPassword=!1;var c=null,i=d(function(){c=f.open({templateUrl:"userSettingsUserAccountDeletionModal.html",keyboard:!1,backdrop:"static",animation:!1})},1e3);h.remove({username:b.username,password:a.deleteAccountModel.password}).$promise.then(function(){return e.debug('Account successfully deleted for user "'+b.username+'"'),c?c.close():d.cancel(i),g.signOutUser(),!0},function(f){return c?c.dismiss():d.cancel(i),403===f.status?a.serverError.invalidPassword=!0:(e.debug('Unexpected error while deleting account for user "'+b.username+'"'),a.serverError.message=" status code: "+f.status,a.serverError.message+=" message: "+(f.data&&f.data.msg?f.data.msg:"no error message provided")),!1}).then(function(){a.state.isInFlightReq=!1})}}}]),angular.module("codeboardApp").controller("VerificationCtrl",["$scope","verificationResult",function(a,b){a.data={msg:b.msg}}]),angular.module("codeboardApp").controller("ErrorCtrl",["$scope","UserSrv",function(a,b){a.isAuthenticated=function(){return b.isAuthenticated()},a.signOut=function(){b.signOutUser()}}]);var services=angular.module("codeboardApp");services.factory("ProjectFactory",["$http","$routeParams","$q","$log","$cookies","$location","ProjectRes","ProjectSubmissionRes",function(a,b,c,d,e,f,g,h){var i={},j=function(){return i},k=function(a){i=a},l="",m="",n=function(){m=o()},o=function(){for(var a=F(j().files),b=[],c=0;c<a.length;c++){var d={filename:a[c].filename,path:a[c].path,uniqueUId:a[c].uniqueUId,parentUId:a[c].parentUId,isFolder:a[c].isFolder,content:a[c].content};b.push(d)}var e=new jsSHA(angular.toJson(b),"TEXT");return e.getHash("SHA-256","HEX")},p=function(){var a=o();return a!==m},q=function(a,b,c,d,e){var f={};return f.id=e.id||-1,f.filename=a,f.path=b,f.uniqueId=c,f.parentUId=d,f.isFolder=e.isFolder||!1,f.content=e.content||"",f.isHidden=e.isHidden||!1,f.isFolder&&(f.children=[]),f.isFolder||(f.session=null),f.filename_annotated=f.filename+u(f),f},r=function(a){if("string"!=typeof a){var b=j().idToNodeMap[a];return b?b:null}if("s"===a.charAt(0)){{var c=a.substring(1);j().staticFiles[c].url}return j().staticFiles[c].content||(j().staticFiles[c].content="-- Fetching file content. Please wait...",j().staticFiles[c].isContentSet=!1),j().staticFiles[c]}},s=function(a){return j().idToNodeMap[a]?!0:!1},t=function(a,b){if(b){if(a.isFolder)for(var c=0;c<a.children.length;c++)t(a.children[c],b)}else{var d=r(a.parentUId);d&&t(d,b)}a.isHidden=b,a.filename_annotated=a.filename+u(a)},u=function(a){var b="";return a.isHidden&&(b+=" (",a.isHidden&&(b+="h"),b+=")"),b},v=function(a,b){return a>b?1:b>a?-1:0},w=function(a,b){return a.isFolder&&!b.isFolder?-1:!a.isFolder&&b.isFolder?1:a.isFolder&&b.isFolder?v(a.filename,b.filename):a.isFolder||b.isFolder?0:v(a.filename,b.filename)},x=function(a,b){var c=j().idToNodeMap[a];if(c.isFolder){var d=q(b.filename,b.path,b.uniqueId,b.parentUId,{isFolder:b.isFolder,id:b.id,content:b.content,isHidden:b.isHidden});return j().idToNodeMap[d.uniqueId]=d,c.children.push(d),c.children.sort(w),d}return null},y=function(a,b,c){var d=a,e=j().idToNodeMap[a];if(e.isFolder||(e=j().idToNodeMap[e.parentUId],d=e.uniqueId),e.isFolder){j().lastUId+=1;var f=""===e.path?"":e.path+"/",g=q(b,f+r(d).filename,j().lastUId,d,{isFolder:c,isHidden:e.isHidden});return j().idToNodeMap[g.uniqueId]=g,e.children.push(g),e.children.sort(w),g}return null},z=function(a,b){return y(a,b,!1)},A=function(a,b){return y(a,b,!0)},B=function(a,b){var c=function(a,b){if(a.path=b,a.children)for(var d=0;d<a.children.length;d++)c(a.children[d],a.path+"/"+a.filename)},d=j().idToNodeMap[a];d&&(d.filename=b,d.filename_annotated=b+u(d),d.isFolder&&c(d,d.path),l="")},C=function(a,b){if(void 0!==j().idToNodeMap[a]&&0!==j().idToNodeMap[a].uniqueId&&(!j().idToNodeMap[a].isFolder||0===j().idToNodeMap[a].children.length||b===!0)){var c=j().idToNodeMap[a],d=j().idToNodeMap[c.parentUId],e=d.children.indexOf(c);d.children.splice(e,1),delete j().idToNodeMap[a],l=""}},D=function(a,b,c){var d={},e=[];l="","[object Object]"===Object.prototype.toString.call(arguments[1])?d=arguments[1]:"[object Array]"===Object.prototype.toString.call(arguments[1])&&(e=arguments[1]),"[object Array]"===Object.prototype.toString.call(arguments[2])&&(e=c);var f={name:a.projectname,lastUId:a.lastUId,files:[],idToNodeMap:[],language:a.language,ltiData:{},context:a.context?a.context:null,userRole:a.userRole,userBeingInspected:a.username?a.username:null,staticFiles:e};k(f),E(d);var g=a.fileSet;g.sort(function(a,b){return a.parentUId<b.parentUId?-1:a.parentUId>b.parentUId?1:0});var h=q(g[0].filename,g[0].path,g[0].uniqueId,g[0].parentUId,{content:g[0].content,isFolder:g[0].isFolder,id:g[0].id,isHidden:g[0].isHidden});j().files.push(h),j().idToNodeMap[j().files[0].uniqueId]=j().files[0];for(var i=1;i<g.length;i++)x(g[i].parentUId,g[i]);n()},E=function(a){a.ltiSessionId&&a.ltiUserId&&a.ltiNonce?(j().ltiData=a,j().hasLtiData=!0):j().hasLtiData=!1},F=function(a){var b=[];for(var c in a){var d=[{filename:a[c].filename,path:a[c].path,content:a[c].content,uniqueId:a[c].uniqueId,parentUId:a[c].parentUId,isFolder:a[c].isFolder,id:a[c].id,isHidden:a[c].isHidden}];b=a[c].children?b.concat(F(a[c].children),d):b.concat(d)}return b},G=function(){var a={project:{lastUId:j().lastUId},files:F(j().files)};j().hasLtiData&&(a.hasLtiData=j().hasLtiData,a.ltiData=j().ltiData);var d=c.defer();return g.update({projectId:b.projectId},a,function(a,b,c){n(),d.resolve({status:c})},function(a){d.reject({status:a.status})}),d.promise},H=function(a){var b=F(j().files),c={},d=[];for(var e in b)if(!b[e].isFolder){var f=b[e].path+"/"+b[e].filename,g={filename:f,content:b[e].content};d.push(g)}return c.files=d,c.language=j().language,c.action="compile",""===l||a||(c.id=l),j().context&&(c.context=j().context),c.hasLtiData=j().hasLtiData,c.ltiData=j().ltiData,c},I=function(a){var d=H(a),e=c.defer();return g.save({projectId:b.projectId},d,function(a){l=a.id,N(a.id),e.resolve(a)},function(a){l="",O();var b="\n-- Error details --";a.status&&a.data&&a.data.msg?(b+="\nStatus code: "+a.status,b+="\nError message: "+a.data.msg):a.status&&a.data&&a.data.output?(b+="\nStatus code: "+a.status,b+="\nError message: "+a.data.output):b+="\n"+JSON.stringify(a),e.reject(b)}),e.promise},J=function(){var a={};a.language=j().language,a.action="run",a.id=l,j().context&&(a.context=j().context),a.hasLtiData=j().hasLtiData,a.ltiData=j().ltiData,N(l);var d=c.defer();return g.save({projectId:b.projectId},a,function(a){d.resolve(a)},function(a){l="";var b="\n-- Error details --";a.status&&a.data&&a.data.msg?(b+="\nStatus code: "+a.status,b+="\nError message: "+a.data.msg):b+="\n"+JSON.stringify(a),d.reject(b)}),d.promise},K=function(){var a=H(!0);a.action="test";var d=c.defer();return g.save({projectId:b.projectId},a,function(a){l=a.id,d.resolve(a)},function(a){l="";var b="\n-- Error details --";b+="\nStatus text: ",b+=a.statusText?a.statusText:"not available",b+="\nStatus code: ",b+=a.status?a.status:"not available",b+="\nError no: ",b+=a.data&&a.data.cause&&a.data.cause.errno?a.data.cause.errno:"not available",b+="\nError output: ",b+=a.data&&a.data.output?a.data.output:"not available",d.reject(b)}),d.promise},L=function(){var a=H(!0);a.action="tool";var d=c.defer();return g.save({projectId:b.projectId},a,function(a){d.resolve(a)},function(a){l="";var b="\n-- Error details --";b+="\n\nStatusCode: ",b+=a.status?a.status:"no status code available",b+="\nMsg: ",b+=a.data.msg?a.data.msg:"no error details available",d.reject(b)}),d.promise},M=function(){var a=H(!1);a.filesInDefaultFormat=F(j().files),a.userRole=j().userRole;var d=c.defer();return h.save({projectId:b.projectId},a,function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise},N=function(a){var b=new Date(Date.now()+18e5);"https"===f.protocol()?e.put("codeboardio_resourcepath",a,{expires:b,path:"/resources",secure:!0,samesite:"none"}):e.put("codeboardio_resourcepath",a,{expires:b,path:"/resources"})},O=function(){e.remove("codeboardio_resourcepath")};return{getProject:j,addFile:z,addFolder:A,renameNode:B,removeNode:C,getNode:r,hasNode:s,setNodeHidden:t,setProjectFromJSONdata:D,saveProjectToServer:G,compileProject:I,runProject:J,testProject:K,toolAction:L,submitProject:M,isProjectModified:p,getNodeArray:F,getNewNode:q}}]);var uploadService=angular.module("uploadService",["ngResource","angularFileUpload"]),MyCtrl=["$scope","$upload",function(a,b){a.onSendFiles=function(c){for(var d=0;d<c.length;d++){var e=c[d],f={url:"/uploadProfilePicture/"+a.userId,data:{user:a.userId},file:e};a.upload=b.upload(f).progress(function(){}).success(function(a){alert(a.reply)})}}}];angular.module("codeboardApp").service("IdeMsgService",function(){this.msgDisplayFileRequest=function(a){return{msg:"ide.displayFileRequest",data:{nodeId:a}}},this.msgNewNodeRequest=function(a){return{msg:"ide.newNodeRequest",data:{nodeType:a}}},this.msgNewNodeNameAvailable=function(a,b){return{msg:"ide.newNodeNameAvailable",data:{nodeName:a,nodeType:b}}},this.msgRenameNodeRequest=function(){return{msg:"ide.renameNodeRequest"}},this.msgDisplayRenameNodeModalRequest=function(a,b,c){return{msg:"ide.displayRenameNodeModalRequest",data:{nodeId:a,nodeName:b,nodeType:c}}},this.msgRenameNodeNameAvailable=function(a,b){return{msg:"ide.renameNodeNameAvailable",data:{nodeId:a,nodeName:b}}},this.msgRemoveNodeRequest=function(){return{msg:"ide.removeNodeRequest"}},this.msgRemoveNodeConfirmation=function(a){return{msg:"ide.removeNodeConfirmation",data:{uniqueId:a}}},this.msgSaveProjectRequest=function(){return{msg:"ide.saveProjectRequest"}},this.msgHideNodeRequest=function(){return{msg:"ide.hideNodeRequest"}},this.msgCompileRequest=function(){return{msg:"ide.compileRequest"}},this.msgCompileCleanRequest=function(){return{msg:"ide.compileCleanRequest"}},this.msgRunRequest=function(){return{msg:"ide.runRequest"}},this.msgStopRequest=function(){return{msg:"ide.stopRequest"}},this.msgStoppableActionAvailable=function(){return{msg:"ide.stoppableActionAvailable"}},this.msgStoppableActionGone=function(){return{msg:"ide.stoppableActionGone"}},this.msgTestRequest=function(){return{msg:"ide.testRequest"}},this.msgToolRequest=function(){return{msg:"ide.toolRequest"}},this.msgSubmitRequest=function(){return{msg:"ide.SubmitRequest"}},this.msgDisplayEditorRequest=function(a){return{msg:"ide.displayEditorRequest",data:{displayEditor:a}}},this.msgShowOutputAsText=function(){return{msg:"ide.showOutputAsText"}},this.msgReloadTreeFromProjectFactory=function(){return{msg:"ide.reloadTreeFromProjectFactory"}},this.msgShowEditorSettingsRequest=function(a){return{msg:"ide.showEditorSettingsRequest",data:{settings:a}}},this.msgEditorSettingsChanged=function(a){return{msg:"ide.editorSettingsChanged",data:{settings:a}}},this.msgEditorResizeRequest=function(){return{msg:"ide.editorResizeRequest"}},this.msgProcessViewQueryStringRequest=function(){return{msg:"ide.processViewQueryStringRequest"}},this.msgShowShareProjectModalRequest=function(){return{msg:"ide.showShareProjectModalRequest"}}}),angular.module("codeboardApp").service("IdeSnippetsSrv",function(){this.getEiffelSnippet=function(){return[{content:"feature {${1:CLASS}} -- ${2:comment}",name:"feature modifier",tabTrigger:"feature"},{content:'note\n	description : "Description of the class"\n	author      : "Name of author"\n\nclass\n	${1:CLASS_NAME}\n\ninherit\n	${2:CLASS_INHERIT}\n\nfeature {${3:CLASS_FEATURE}} -- ${4: feature comment}\n\n	${5:--Add your routines here}\n\nend',name:"class",tabTrigger:"class"},{content:"${1:name}: ${2:type} = ${3}",name:"const",tabTrigger:"const"},{content:"inspect\n	${1:exp}\nwhen ${2:value} then\n	${3:-- code 1 here}\nelse\n	${4:-- code 2 here}\nend",name:"inspect",tabTrigger:"inspect"},{content:"when ${2:value} then\n	${3:-- code here}",name:"when",tabTrigger:"when"},{content:"from\n	${1}\nuntil\n	${2}\nloop\n	${3}\nend",name:"from loop",tabTrigger:"from_loop"},{content:"across ${1:my_list} as ${2:ic} loop ${3:print(ic.item)} end",name:"across loop",tabTrigger:"across_loop"},{content:"if ${1:exp} then\n	${2:-- code here }\nend",name:"if",tabTrigger:"if"},{content:"if ${1:exp} then\n	${2:-- code}\nelse\n	${3:-- code here}\nend",name:"ifelse",tabTrigger:"ifelse"},{content:"${1:routine_name} (${2:i: INTEGER})\n		${3:-- feature comment}\n	require\n		${4:-- preconditions}\n	do\n		${5:-- code here}\n	ensure\n		${6:-- postconditions}\n	end",name:"routine",tabTrigger:"routine"},{content:"check\n	${1:assertion}\nend ",name:"check",tabTrigger:"check"},{content:"create ${1:var}.make (${2:arguments}) ",name:"create",tabTrigger:"create"},{content:"local\n	${1:var}: ${2:type}",name:"local",tabTrigger:"local"},{content:'print("${1:message}%N")',name:"Hint: print message",tabTrigger:"hint_print"},{content:"from\n	my_list.start\nuntil\n	my_list.off\nloop\n	print (my_list.item)\n	my_list.forth\nend",name:"Hint: from-loop over a list",tabTrigger:"hint_from_loop_over_a_list"},{content:"across my_list as ic loop print (ic.item) end",name:"Hint: across-loop over a list",tabTrigger:"hint_across_loop_over_a_list"}]}}),angular.module("codeboardApp").service("UserSrv",["$rootScope","SessionRes","$log","$location",function(a,b,c,d){var e=!1,f="";this.getUsername=function(){return f},this.isAuthenticated=function(){return e};var g=function(a){f=a,e=!0};this.signOutUser=function(){b.remove(function(){d.path("/")}),f="",e=!1},this.tryAuthenticateUser=function(){b.get(function(b){g(b.username),a.$broadcast("userLoggedIn")},function(a){c.debug("Cannot authenticate user; Status: "+a.status),e=!1,f=""})}}]),angular.module("codeboardApp").factory("WebsocketSrv",["$websocket","$log",function(a,b){var c=null,d=function(d,e,f,g){c=a(d),c.onOpen(function(){e()}),c.onMessage(function(a){f(a.data)}),c.onClose(function(){b.debug("websocketSrvjs.onClose: the websocket connection was closed!"),g()}),c.onError(function(){b.debug("websocketSrvjs.onError: websocket error")})},e=function(a){var b=a||!1;c.close(b)},f=function(a){c&&1===c.readyState?(b.debug("WebsocketSrvjs.sendData: sending data "+a),c.send(a)):b.debug("WebsocketSrvjs.sendData: not sending data; WS not initialized or readyState not 1")};return{connect:d,close:e,sendData:f}}]),angular.module("codeboardApp").service("StatsSrv",function(){var a=function(a,b){var c=new Date(a.getTime());return c.setDate(c.getDate()+b),c},b=function(b,c){return a(b,-c)},c=function(b,c,d){for(var e=b;c>=e;){var f={_id:{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()},count:0};d.push(f),e=a(e,1)}},d=function(d,e,f){var g=function(a,b){return new Date(a._id.year,a._id.month-1,a._id.day)-new Date(b._id.year,b._id.month-1,b._id.day)};f.sort(g);var h=f.length,i=864e5;if(0===h)c(d,e,f);else{var j=new Date(f[0]._id.year,f[0]._id.month-1,f[0]._id.day);if(j-d>=i){var k=b(j,1);c(d,k,f)}var l=new Date(f[h-1]._id.year,f[h-1]._id.month-1,f[h-1]._id.day);if(e-l>=i){var m=a(l,1);c(m,e,f)}}for(var n=0;h-1>n;n++){var o=new Date(f[n]._id.year,f[n]._id.month-1,f[n]._id.day),p=new Date(f[n+1]._id.year,f[n+1]._id.month-1,f[n+1]._id.day);if(p-o>=i){var q=a(o,1),r=b(p,1);c(q,r,f)}}f.sort(g)};return{sortAndAddMissingDates:d}}),angular.module("codeboardApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("codeboardApp").directive("ngSelectOnFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){c.on("focus",function(){var b=this;a(function(){b.select()},10)})}}}]),angular.module("codeboardApp").factory("ProjectSettingsRes",["$resource",function(a){return a("/api/projects/:projectId/settings",{projectId:"@id"})}]).factory("ProjectSummaryRes",["$resource",function(a){return a("/api/projects/:projectId/summary",{projectId:"@id"})}]).factory("ProjectSubmissionRes",["$resource",function(a){return a("/api/projects/:projectId/submissions",{projectId:"@id"})}]).factory("ProjectRes",["$resource",function(a){return a("/api/projects/:projectId",{projectId:"@id"},{update:{method:"PUT"}})}]),angular.module("codeboardApp").factory("SessionRes",["$resource",function(a){return a("/api/session")}]),angular.module("codeboardApp").factory("UserRes",["$resource",function(a){return a("/api/users/:username",{username:"@username"})}]).factory("UserResSettings",["$resource",function(a){return a("/api/users/:username/settings",{username:"@username"},{update:{method:"PUT"}})}]).factory("UsersAllRes",["$resource",function(a){return a("/api/users/")}]),angular.module("codeboardApp").factory("UserProjectRes",["$resource",function(a){return a("/api/projects/:projectId/userprojects/:userprojectId",{userprojectId:"@userprojectId",projectId:"@projectId"})}]);